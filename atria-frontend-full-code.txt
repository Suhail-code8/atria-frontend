// ============================================
// FILE: src/App.tsx
// ============================================
import { useLocation, useRoutes } from 'react-router-dom'
import { AuthProvider } from './auth/AuthContext'
import { routes } from './routes'

function App() {
  const location = useLocation()

  console.log('App - Current location:', location.pathname)

  return (
    <AuthProvider>
      <RoutesWrapper />
    </AuthProvider>
  )
}

const RoutesWrapper = () => {
  const element = useRoutes(routes)
  return element
}

export default App


// ============================================
// FILE: src/api/auth.api.ts
// ============================================
import axiosInstance from './axios'
import { AuthResponse, User } from '../types'

export const authApi = {
  login: (email: string, password: string) =>
    axiosInstance.post<AuthResponse>('/auth/login', { email, password }),

  register: (name: string, email: string, password: string, role: string) =>
    axiosInstance.post<AuthResponse>('/auth/register', { name, email, password, role }),

  logout: () =>
    axiosInstance.post('/auth/logout'),

  getCurrentUser: (): User | null => {
    const user = localStorage.getItem('user')
    return user ? JSON.parse(user) : null
  },

  setCurrentUser: (user: User) => {
    localStorage.setItem('user', JSON.stringify(user))
  },

  clearAuth: () => {
    localStorage.removeItem('accessToken')
    localStorage.removeItem('user')
  }
}


// ============================================
// FILE: src/api/axios.ts
// ============================================
import axios, { AxiosInstance, AxiosError, InternalAxiosRequestConfig } from 'axios'

const API_BASE = '/api'

const axiosInstance: AxiosInstance = axios.create({
  baseURL: API_BASE,
  withCredentials: true,
  headers: {
    'Content-Type': 'application/json'
  }
})

// Request interceptor: attach access token
axiosInstance.interceptors.request.use((config: InternalAxiosRequestConfig) => {
  const token = localStorage.getItem('accessToken')
  if (token) {
    config.headers.Authorization = `Bearer ${token}`
  }
  return config
})

// Response interceptor: handle 401, refresh token
let isRefreshing = false
let failedQueue: Array<(token: string) => void> = []

const processQueue = (token: string) => {
  failedQueue.forEach(cb => cb(token))
  failedQueue = []
}

axiosInstance.interceptors.response.use(
  response => response,
  async (error: AxiosError) => {
    const originalRequest = error.config as InternalAxiosRequestConfig & { _retry?: boolean }

    if (error.response?.status === 401 && !originalRequest._retry) {
      if (isRefreshing) {
        return new Promise((resolve) => {
          failedQueue.push((token: string) => {
            originalRequest.headers.Authorization = `Bearer ${token}`
            resolve(axiosInstance(originalRequest))
          })
        })
      }

      isRefreshing = true
      originalRequest._retry = true

      try {
        const response = await axios.post(
          `${API_BASE}/auth/refresh`,
          {},
          { withCredentials: true }
        )
        const newToken = response.data.data.accessToken
        localStorage.setItem('accessToken', newToken)
        processQueue(newToken)
        originalRequest.headers.Authorization = `Bearer ${newToken}`
        return axiosInstance(originalRequest)
      } catch (refreshError) {
        localStorage.removeItem('accessToken')
        window.location.href = '/login'
        return Promise.reject(refreshError)
      } finally {
        isRefreshing = false
      }
    }

    return Promise.reject(error)
  }
)

export default axiosInstance


// ============================================
// FILE: src/api/events.api.ts
// ============================================
import axiosInstance from './axios'
import { Event } from '../types'

export const eventsApi = {
  listEvents: () =>
    axiosInstance.get<{ success: boolean; data: Event[] }>('/events'),

  getEvent: (eventId: string) =>
    axiosInstance.get<{ success: boolean; data: Event }>(`/events/${eventId}`),

  createEvent: (data: Partial<Event>) =>
    axiosInstance.post<{ success: boolean; data: Event }>('/events', data),

  updateEvent: (eventId: string, data: Partial<Event>) =>
    axiosInstance.put<{ success: boolean; data: Event }>(`/events/${eventId}`, data),

  deleteEvent: (eventId: string) =>
    axiosInstance.delete<{ success: boolean; data: Event }>(`/events/${eventId}`)
}


// ============================================
// FILE: src/api/participation.api.ts
// ============================================
import axiosInstance from './axios'
import { Participation, ParticipationStatus } from '../types'

export const participationApi = {
  registerForEvent: (eventId: string) =>
    axiosInstance.post<{ success: boolean; data: Participation }>(
      `/events/${eventId}/register`
    ),

  listParticipants: (eventId: string) =>
    axiosInstance.get<{ success: boolean; data: Participation[] }>(
      `/events/${eventId}/participants`
    ),

  getMyParticipation: (eventId: string) =>
    axiosInstance.get<{ success: boolean; data: Participation | null }>(
      `/events/${eventId}/my-participation`
    ),

  updateParticipationStatus: (eventId: string, participationId: string, status: ParticipationStatus) =>
    axiosInstance.patch<{ success: boolean; data: Participation }>(
      `/events/${eventId}/participants/${participationId}`,
      { status }
    )
}


// ============================================
// FILE: src/api/submissions.api.ts
// ============================================
import axiosInstance from './axios'
import { Submission } from '../types'

export const submissionsApi = {
  getSubmission: (eventId: string, submissionId: string) =>
    axiosInstance.get<{ success: boolean; data: Submission }>(
      `/events/${eventId}/submissions/${submissionId}`
    ),

  createSubmission: (eventId: string, data: Partial<Submission>) =>
    axiosInstance.post<{ success: boolean; data: Submission }>(
      `/events/${eventId}/submissions`,
      data
    ),

  updateSubmission: (eventId: string, submissionId: string, data: Partial<Submission>) =>
    axiosInstance.put<{ success: boolean; data: Submission }>(
      `/events/${eventId}/submissions/${submissionId}`,
      data
    ),

  submitSubmission: (eventId: string, submissionId: string) =>
    axiosInstance.post<{ success: boolean; data: Submission }>(
      `/events/${eventId}/submissions/${submissionId}/submit`
    ),

  listMySubmissions: (eventId: string) =>
    axiosInstance.get<{ success: boolean; data: Submission[] }>(
      `/events/${eventId}/my-submissions`
    ),

  listSubmissions: (eventId: string) =>
    axiosInstance.get<{ success: boolean; data: Submission[] }>(
      `/events/${eventId}/submissions`
    )
}


// ============================================
// FILE: src/auth/AuthContext.tsx
// ============================================
import { createContext, useContext, useState, useEffect, ReactNode } from 'react'
import { User } from '../types'

interface AuthContextType {
  user: User | null
  accessToken: string | null
  isLoading: boolean
  setUser: (user: User | null) => void
  setAccessToken: (token: string | null) => void
}

const AuthContext = createContext<AuthContextType | undefined>(undefined)

export const AuthProvider = ({ children }: { children: ReactNode }) => {
  const [user, setUser] = useState<User | null>(null)
  const [accessToken, setAccessToken] = useState<string | null>(null)
  const [isLoading, setIsLoading] = useState(true)

  useEffect(() => {
    const storedUser = localStorage.getItem('user')
    const storedToken = localStorage.getItem('accessToken')
    
    if (storedUser && storedToken) {
      setUser(JSON.parse(storedUser))
      setAccessToken(storedToken)
    }
    setIsLoading(false)
  }, [])

  const value = {
    user,
    accessToken,
    isLoading,
    setUser: (newUser: User | null) => {
      setUser(newUser)
      if (newUser) {
        localStorage.setItem('user', JSON.stringify(newUser))
      } else {
        localStorage.removeItem('user')
      }
    },
    setAccessToken: (token: string | null) => {
      setAccessToken(token)
      if (token) {
        localStorage.setItem('accessToken', token)
      } else {
        localStorage.removeItem('accessToken')
      }
    }
  }

  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>
}

export const useAuth = () => {
  const context = useContext(AuthContext)
  if (!context) {
    throw new Error('useAuth must be used within AuthProvider')
  }
  return context
}


// ============================================
// FILE: src/auth/Login.tsx
// ============================================
import { useState } from 'react'
import { useNavigate } from 'react-router-dom'
import { authApi } from '../api/auth.api'
import { useAuth } from './AuthContext'
import Button from '../components/Button'
import Input from '../components/Input'
import { AlertCircle } from 'lucide-react'

export const Login = () => {
  const navigate = useNavigate()
  const { setUser, setAccessToken } = useAuth()
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [error, setError] = useState('')
  const [isLoading, setIsLoading] = useState(false)

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setError('')
    setIsLoading(true)

    try {
      const response = await authApi.login(email, password)
      const { accessToken, user } = response.data.data
      
      setAccessToken(accessToken)
      setUser(user)
      navigate('/events')
    } catch (err: any) {
      setError(err.response?.data?.message || 'Login failed. Please try again.')
    } finally {
      setIsLoading(false)
    }
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-primary-50 to-primary-100 flex items-center justify-center p-4">
      <div className="bg-white rounded-lg shadow-xl p-8 w-full max-w-md">
        <h1 className="text-3xl font-bold text-gray-900 mb-2">Atria</h1>
        <p className="text-gray-600 mb-8">Event Platform</p>

        {error && (
          <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-6 flex gap-3">
            <AlertCircle className="w-5 h-5 text-red-600 flex-shrink-0" />
            <p className="text-red-800 text-sm">{error}</p>
          </div>
        )}

        <form onSubmit={handleSubmit} className="space-y-4">
          <Input
            label="Email"
            type="email"
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            required
          />
          <Input
            label="Password"
            type="password"
            value={password}
            onChange={(e) => setPassword(e.target.value)}
            required
          />
          <Button type="submit" variant="primary" isLoading={isLoading} className="w-full">
            Sign In
          </Button>
        </form>

        <p className="text-center text-gray-600 text-sm mt-6">
          Don't have an account?{' '}
          <a href="/register" className="text-primary-600 hover:text-primary-700 font-semibold">
            Sign up
          </a>
        </p>
      </div>
    </div>
  )
}

export default Login


// ============================================
// FILE: src/auth/Register.tsx
// ============================================
import { useState } from 'react'
import { useNavigate } from 'react-router-dom'
import { authApi } from '../api/auth.api'
import { useAuth } from './AuthContext'
import Button from '../components/Button'
import Input from '../components/Input'
import { AlertCircle } from 'lucide-react'

const ROLES = [
  { value: 'ORGANIZER', label: 'Organizer' },
  { value: 'PARTICIPANT', label: 'Participant' }
]

export const Register = () => {
  const navigate = useNavigate()
  const { setUser, setAccessToken } = useAuth()
  const [formData, setFormData] = useState({ name: '', email: '', password: '', role: 'PARTICIPANT' })
  const [error, setError] = useState('')
  const [isLoading, setIsLoading] = useState(false)

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {
    setFormData(prev => ({ ...prev, [e.target.name]: e.target.value }))
  }

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setError('')
    setIsLoading(true)

    try {
      const response = await authApi.register(
        formData.name,
        formData.email,
        formData.password,
        formData.role
      )
      const { accessToken, user } = response.data.data
      
      setAccessToken(accessToken)
      setUser(user)
      navigate('/events')
    } catch (err: any) {
      setError(err.response?.data?.message || 'Registration failed. Please try again.')
    } finally {
      setIsLoading(false)
    }
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-primary-50 to-primary-100 flex items-center justify-center p-4">
      <div className="bg-white rounded-lg shadow-xl p-8 w-full max-w-md">
        <h1 className="text-3xl font-bold text-gray-900 mb-2">Join Atria</h1>
        <p className="text-gray-600 mb-8">Create your account</p>

        {error && (
          <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-6 flex gap-3">
            <AlertCircle className="w-5 h-5 text-red-600 flex-shrink-0" />
            <p className="text-red-800 text-sm">{error}</p>
          </div>
        )}

        <form onSubmit={handleSubmit} className="space-y-4">
          <Input
            label="Full Name"
            type="text"
            name="name"
            value={formData.name}
            onChange={handleChange}
            required
          />
          <Input
            label="Email"
            type="email"
            name="email"
            value={formData.email}
            onChange={handleChange}
            required
          />
          <Input
            label="Password"
            type="password"
            name="password"
            value={formData.password}
            onChange={handleChange}
            required
          />
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              Account Type
            </label>
            <select
              name="role"
              value={formData.role}
              onChange={handleChange}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"
            >
              {ROLES.map(role => (
                <option key={role.value} value={role.value}>
                  {role.label}
                </option>
              ))}
            </select>
          </div>
          <Button type="submit" variant="primary" isLoading={isLoading} className="w-full">
            Create Account
          </Button>
        </form>

        <p className="text-center text-gray-600 text-sm mt-6">
          Already have an account?{' '}
          <a href="/login" className="text-primary-600 hover:text-primary-700 font-semibold">
            Sign in
          </a>
        </p>
      </div>
    </div>
  )
}

export default Register


// ============================================
// FILE: src/components/Badge.tsx
// ============================================
import { EventStatus, SubmissionStatus, ParticipationStatus } from '../types'

const statusBadgeColors: Record<string, string> = {
  // EventStatus
  'EventStatus.DRAFT': 'bg-gray-100 text-gray-800',
  'EventStatus.PUBLISHED': 'bg-blue-100 text-blue-800',
  'EventStatus.ONGOING': 'bg-green-100 text-green-800',
  'EventStatus.COMPLETED': 'bg-gray-100 text-gray-800',
  // SubmissionStatus
  'SubmissionStatus.DRAFT': 'bg-yellow-100 text-yellow-800',
  'SubmissionStatus.SUBMITTED': 'bg-blue-100 text-blue-800',
  'SubmissionStatus.UNDER_REVIEW': 'bg-purple-100 text-purple-800',
  'SubmissionStatus.APPROVED': 'bg-green-100 text-green-800',
  'SubmissionStatus.REJECTED': 'bg-red-100 text-red-800',
  // ParticipationStatus
  'ParticipationStatus.REGISTERED': 'bg-blue-100 text-blue-800',
  'ParticipationStatus.APPROVED': 'bg-green-100 text-green-800',
  'ParticipationStatus.REJECTED': 'bg-red-100 text-red-800',
  'ParticipationStatus.WITHDRAWN': 'bg-gray-100 text-gray-800',
  // Fallbacks for string values
  [EventStatus.DRAFT]: 'bg-gray-100 text-gray-800',
  [EventStatus.PUBLISHED]: 'bg-blue-100 text-blue-800',
  [EventStatus.ONGOING]: 'bg-green-100 text-green-800',
  [EventStatus.COMPLETED]: 'bg-gray-100 text-gray-800',
  [SubmissionStatus.SUBMITTED]: 'bg-blue-100 text-blue-800',
  [SubmissionStatus.UNDER_REVIEW]: 'bg-purple-100 text-purple-800',
  [SubmissionStatus.APPROVED]: 'bg-green-100 text-green-800',
  [ParticipationStatus.REGISTERED]: 'bg-blue-100 text-blue-800',
  [ParticipationStatus.WITHDRAWN]: 'bg-gray-100 text-gray-800'
}

interface BadgeProps {
  status: string
  children?: React.ReactNode
}

const Badge = ({ status, children }: BadgeProps) => {
  const colorClass = statusBadgeColors[status] || 'bg-gray-100 text-gray-800'

  return (
    <span className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${colorClass}`}>
      {children || status}
    </span>
  )
}

export default Badge


// ============================================
// FILE: src/components/Button.tsx
// ============================================
import React from 'react'
import { Loader as LoaderIcon } from 'lucide-react'

interface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: 'primary' | 'secondary' | 'danger' | 'ghost'
  size?: 'sm' | 'md' | 'lg'
  isLoading?: boolean
  children: React.ReactNode
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ variant = 'primary', size = 'md', isLoading = false, className = '', children, disabled, ...props }, ref) => {
    const baseStyles = 'font-medium rounded-lg transition-colors inline-flex items-center justify-center gap-2'
    
    const variantStyles = {
      primary: 'bg-primary-600 text-white hover:bg-primary-700 disabled:bg-primary-300',
      secondary: 'bg-gray-200 text-gray-900 hover:bg-gray-300 disabled:bg-gray-100',
      danger: 'bg-red-600 text-white hover:bg-red-700 disabled:bg-red-300',
      ghost: 'bg-transparent text-primary-600 hover:bg-primary-50 disabled:text-primary-300'
    }

    const sizeStyles = {
      sm: 'px-3 py-1.5 text-sm',
      md: 'px-4 py-2 text-base',
      lg: 'px-6 py-3 text-lg'
    }

    return (
      <button
        ref={ref}
        disabled={disabled || isLoading}
        className={`${baseStyles} ${variantStyles[variant]} ${sizeStyles[size]} ${className}`}
        {...props}
      >
        {isLoading && <LoaderIcon className="w-4 h-4 animate-spin" />}
        {children}
      </button>
    )
  }
)

Button.displayName = 'Button'

export default Button


// ============================================
// FILE: src/components/Input.tsx
// ============================================
import React from 'react'

interface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {
  label?: string
  error?: string
}

const Input = React.forwardRef<HTMLInputElement, InputProps>(
  ({ label, error, className = '', ...props }, ref) => {
    return (
      <div className="w-full">
        {label && <label className="block text-sm font-medium text-gray-700 mb-2">{label}</label>}
        <input
          ref={ref}
          className={`w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent ${
            error ? 'border-red-500 focus:ring-red-500' : ''
          } ${className}`}
          {...props}
        />
        {error && <p className="text-red-600 text-sm mt-1">{error}</p>}
      </div>
    )
  }
)

Input.displayName = 'Input'

export default Input


// ============================================
// FILE: src/components/Loader.tsx
// ============================================
// import { Loader as LoaderIcon } from 'lucide-react'

// interface LoaderProps {
//   size?: 'sm' | 'md' | 'lg'
// }

// const Loader = ({ size = 'md' }: LoaderProps) => {
//   const sizeClasses = {
//     sm: 'w-4 h-4',
//     md: 'w-8 h-8',
//     lg: 'w-12 h-12'
//   }

//   return (
//     <div className="flex items-center justify-center">
//       <LoaderIcon className={`${sizeClasses[size]} animate-spin text-primary-600`} />
//     </div>
//   )
// }

// export default Loader


// ============================================
// FILE: src/components/Modal.tsx
// ============================================
import { ReactNode } from 'react'
import { X } from 'lucide-react'

interface ModalProps {
  isOpen: boolean
  onClose: () => void
  title: string
  children: ReactNode
  size?: 'sm' | 'md' | 'lg'
}

const Modal = ({ isOpen, onClose, title, children, size = 'md' }: ModalProps) => {
  if (!isOpen) return null

  const sizeClasses = {
    sm: 'max-w-sm',
    md: 'max-w-md',
    lg: 'max-w-2xl'
  }

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className={`bg-white rounded-lg shadow-xl w-full ${sizeClasses[size]}`}>
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-xl font-bold text-gray-900">{title}</h2>
          <button
            onClick={onClose}
            className="text-gray-500 hover:text-gray-700"
          >
            <X className="w-5 h-5" />
          </button>
        </div>
        <div className="p-6">{children}</div>
      </div>
    </div>
  )
}

export default Modal


// ============================================
// FILE: src/components/ProtectedRoute.tsx
// ============================================
import { Navigate } from 'react-router-dom'
import { useAuth } from '../auth/AuthContext'
import { UserRole } from '../types'

interface ProtectedRouteProps {
  children: React.ReactNode
  allowedRoles?: UserRole[]
}

const ProtectedRoute = ({ children, allowedRoles }: ProtectedRouteProps) => {
  const { user, isLoading } = useAuth()

  if (isLoading) {
    return (
      <div className="flex items-center justify-center h-screen">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600" />
      </div>
    )
  }

  if (!user) {
    return <Navigate to="/login" replace />
  }

  if (allowedRoles && !allowedRoles.includes(user.role)) {
    return <Navigate to="/events" replace />
  }

  return <>{children}</>
}

export default ProtectedRoute


// ============================================
// FILE: src/events/CreateEvent.tsx
// ============================================
import { useState } from 'react'
import { useNavigate } from 'react-router-dom'
import { eventsApi } from '../api/events.api'
import { EventType } from '../types'
import Button from '../components/Button'
import Input from '../components/Input'
import { AlertCircle } from 'lucide-react'
import { getErrorMessage } from '../utils/formatters'

const EVENT_TYPES = [
  { value: 'CONFERENCE', label: 'Conference' },
  { value: 'FEST', label: 'Festival' },
  { value: 'PROGRAM', label: 'Program' },
  { value: 'CUSTOM', label: 'Custom' }
]

export const CreateEvent = () => {
  const navigate = useNavigate()
  const [formData, setFormData] = useState({
    title: '',
    description: '',
    eventType: 'CONFERENCE' as EventType,
    startDate: '',
    endDate: '',
    isPublic: true,
    hasSubmissions: false,
    hasTeams: false,
    hasJudging: false,
    hasScoring: false
  })
  const [error, setError] = useState('')
  const [isLoading, setIsLoading] = useState(false)

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {
    const { name, value, type } = e.target as any
    setFormData(prev => ({
      ...prev,
      [name]: type === 'checkbox' ? (e.target as HTMLInputElement).checked : value
    }))
  }

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setError('')
    setIsLoading(true)

    try {
      const response = await eventsApi.createEvent(formData)
      navigate(`/events/${response.data.data._id}`)
    } catch (err: any) {
      setError(getErrorMessage(err))
    } finally {
      setIsLoading(false)
    }
  }

  return (
    <div className="max-w-2xl">
      <h1 className="text-3xl font-bold text-gray-900 mb-8">Create New Event</h1>

      {error && (
        <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-6 flex gap-3">
          <AlertCircle className="w-5 h-5 text-red-600 flex-shrink-0" />
          <p className="text-red-800">{error}</p>
        </div>
      )}

      <form onSubmit={handleSubmit} className="bg-white rounded-lg shadow p-8 space-y-6">
        <Input
          label="Event Title"
          type="text"
          name="title"
          value={formData.title}
          onChange={handleChange}
          required
        />

        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Description
          </label>
          <textarea
            name="description"
            value={formData.description}
            onChange={handleChange}
            rows={5}
            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"
            required
          />
        </div>

        <div className="grid grid-cols-2 gap-6">
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              Event Type
            </label>
            <select
              name="eventType"
              value={formData.eventType}
              onChange={handleChange}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"
            >
              {EVENT_TYPES.map(t => (
                <option key={t.value} value={t.value}>{t.label}</option>
              ))}
            </select>
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              Visibility
            </label>
            <select
              name="isPublic"
              value={formData.isPublic ? 'true' : 'false'}
              onChange={(e) => setFormData(prev => ({ ...prev, isPublic: e.target.value === 'true' }))}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"
            >
              <option value="true">Public</option>
              <option value="false">Private</option>
            </select>
          </div>
        </div>

        <div className="grid grid-cols-2 gap-6">
          <Input
            label="Start Date"
            type="datetime-local"
            name="startDate"
            value={formData.startDate}
            onChange={handleChange}
            required
          />
          <Input
            label="End Date"
            type="datetime-local"
            name="endDate"
            value={formData.endDate}
            onChange={handleChange}
            required
          />
        </div>

        <div className="border-t pt-6">
          <p className="text-sm font-medium text-gray-700 mb-4">Features</p>
          <div className="space-y-3">
            <label className="flex items-center gap-3">
              <input
                type="checkbox"
                name="hasSubmissions"
                checked={formData.hasSubmissions}
                onChange={handleChange}
                className="w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"
              />
              <span className="text-gray-700">Enable Submissions</span>
            </label>
            <label className="flex items-center gap-3">
              <input
                type="checkbox"
                name="hasTeams"
                checked={formData.hasTeams}
                onChange={handleChange}
                className="w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"
              />
              <span className="text-gray-700">Enable Teams</span>
            </label>
            <label className="flex items-center gap-3">
              <input
                type="checkbox"
                name="hasJudging"
                checked={formData.hasJudging}
                onChange={handleChange}
                className="w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"
              />
              <span className="text-gray-700">Enable Judging</span>
            </label>
          </div>
        </div>

        <div className="flex gap-4 pt-6 border-t">
          <Button type="submit" variant="primary" isLoading={isLoading}>
            Create Event
          </Button>
          <Button
            type="button"
            variant="secondary"
            onClick={() => navigate('/events')}
          >
            Cancel
          </Button>
        </div>
      </form>
    </div>
  )
}

export default CreateEvent


// ============================================
// FILE: src/events/EventDetails.tsx
// ============================================
import { useEffect, useState } from 'react'
import { useLocation, useParams } from 'react-router-dom'
import { eventsApi } from '../api/events.api'
import { participationApi } from '../api/participation.api'
import { Event, Participation } from '../types'
import { useAuth } from '../auth/AuthContext'
import Badge from '../components/Badge'
import Button from '../components/Button'
// import Loader from '../components/Loader'
import Modal from '../components/Modal'
import { AlertCircle, Users } from 'lucide-react'
import { formatDate, getErrorMessage } from '../utils/formatters'
import { Link } from 'react-router-dom'

export const EventDetails = () => {
  const { eventId } = useParams<{ eventId: string }>()
  const location = useLocation()

  // Fallback: also derive ID from URL path in case route params don't populate as expected
  const pathEventId = location.pathname.split('/').filter(Boolean).pop()
  const effectiveEventId = eventId || pathEventId
  const { user } = useAuth()
  const [event, setEvent] = useState<Event | null>(null)
  const [participation, setParticipation] = useState<Participation | null>(null)
  const [isLoading, setIsLoading] = useState(true)
  const [error, setError] = useState('')
  const [isRegistering, setIsRegistering] = useState(false)
  const [showParticipants, setShowParticipants] = useState(false)

  useEffect(() => {
    loadEvent(effectiveEventId)
  }, [effectiveEventId])

  const loadEvent = async (id?: string | null) => {
    console.log('[EventDetails] loadEvent start', { routeParam: eventId, pathEventId, effectiveEventId: id })

    if (!id) {
      console.error('[EventDetails] no eventId found in route params or URL path')
      setError('Invalid event URL. Event ID is missing.')
      setIsLoading(false)
      return
    }

    setIsLoading(true)

    try {
      const eventRes = await eventsApi.getEvent(id)
      console.log('[EventDetails] api response', eventRes)
      setEvent(eventRes.data.data)
      setError('')

      if (user && id) {
        try {
          const partRes = await participationApi.getMyParticipation(id)
          setParticipation(partRes.data.data)
        } catch (err) {
          setParticipation(null)
        }
      }
    } catch (err: any) {
      console.error('[EventDetails] loadEvent error', err)
      setError(getErrorMessage(err))
    } finally {
      setIsLoading(false)
    }
  }

  const handleRegister = async () => {
    if (!eventId) return
    setIsRegistering(true)
    try {
      const res = await participationApi.registerForEvent(eventId)
      setParticipation(res.data.data)
    } catch (err: any) {
      setError(getErrorMessage(err))
    } finally {
      setIsRegistering(false)
    }
  }

  // if (isLoading) return <Loader />
  if (isLoading) return <div className="text-center py-12">Loading event...</div>
  if (!event) return (
    <div className="text-center py-12">
      <p className="text-red-600 font-semibold mb-2">Event not found</p>
      {error && <p className="text-red-500 text-sm">{error}</p>}
      <Link to="/events" className="text-primary-600 hover:text-primary-700 mt-4 inline-block">
        ← Back to Events
      </Link>
    </div>
  )

  const isCreator = user?._id === event.createdBy
  const isRegistered = !!participation

  return (
    <div>
      <Link to="/events" className="text-primary-600 hover:text-primary-700 mb-6 inline-block">
        ← Back to Events
      </Link>

      {error && (
        <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-6 flex gap-3">
          <AlertCircle className="w-5 h-5 text-red-600 flex-shrink-0" />
          <p className="text-red-800">{error}</p>
        </div>
      )}

      <div className="bg-white rounded-lg shadow p-8 mb-8">
        <div className="flex justify-between items-start mb-6">
          <div>
            <h1 className="text-3xl font-bold text-gray-900 mb-2">{event.title}</h1>
            <Badge status={event.status} />
          </div>
        </div>

        <p className="text-gray-600 mb-6 text-lg">{event.description}</p>

        <div className="grid grid-cols-2 md:grid-cols-4 gap-6 mb-8 pb-8 border-b">
          <div>
            <p className="text-sm text-gray-600 mb-1">Type</p>
            <p className="font-semibold">{event.eventType}</p>
          </div>
          <div>
            <p className="text-sm text-gray-600 mb-1">Status</p>
            <Badge status={event.status} />
          </div>
          <div>
            <p className="text-sm text-gray-600 mb-1">Start Date</p>
            <p className="font-semibold">{formatDate(event.startDate)}</p>
          </div>
          <div>
            <p className="text-sm text-gray-600 mb-1">End Date</p>
            <p className="font-semibold">{formatDate(event.endDate)}</p>
          </div>
        </div>

        <div className="flex gap-4">
          {!isCreator && !isRegistered && user && (
            <Button
              variant="primary"
              onClick={handleRegister}
              isLoading={isRegistering}
            >
              Register for Event
            </Button>
          )}
          {isRegistered && (
            <div className="flex items-center gap-2 text-green-700 bg-green-50 px-4 py-2 rounded-lg">
              <span className="font-semibold">✓ Registered</span>
              <Badge status={participation?.status || ''} />
            </div>
          )}
          {isCreator && (
            <>
              <Link to={`/events/${event._id}/manage`}>
                <Button variant="secondary">Manage Event</Button>
              </Link>
              {event.hasSubmissions && (
                <Link to={`/events/${event._id}/submissions`}>
                  <Button variant="secondary">View Submissions</Button>
                </Link>
              )}
              <Button variant="secondary" onClick={() => setShowParticipants(true)}>
                <Users className="w-4 h-4" />
                View Participants
              </Button>
            </>
          )}
          {isRegistered && event.hasSubmissions && (
            <Link to={`/events/${event._id}/my-submissions`}>
              <Button variant="secondary">My Submissions</Button>
            </Link>
          )}
        </div>
      </div>

      <Modal
        isOpen={showParticipants}
        onClose={() => setShowParticipants(false)}
        title="Event Participants"
        size="lg"
      >
        <ParticipantsList eventId={event._id} />
      </Modal>
    </div>
  )
}

const ParticipantsList = ({ eventId }: { eventId: string }) => {
  const [participants, setParticipants] = useState<Participation[]>([])
  const [isLoading, setIsLoading] = useState(true)

  useEffect(() => {
    participationApi.listParticipants(eventId)
      .then(res => setParticipants(res.data.data))
      .finally(() => setIsLoading(false))
  }, [eventId])

  // if (isLoading) return <Loader />
  if (isLoading) return <div className="text-center py-4">Loading participants...</div>

  return (
    <div className="space-y-3">
      {participants.map(p => (
        <div key={p._id} className="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
          <div>
            <p className="font-semibold">{p.user.name}</p>
            <p className="text-sm text-gray-600">{p.user.email}</p>
          </div>
          <div className="flex gap-2">
            <Badge status={p.status} />
          </div>
        </div>
      ))}
    </div>
  )
}

export default EventDetails


// ============================================
// FILE: src/events/EventList.tsx
// ============================================
import { useEffect, useState } from 'react'
import { eventsApi } from '../api/events.api'
import { Event } from '../types'
import { Link } from 'react-router-dom'
import { useAuth } from '../auth/AuthContext'
import Badge from '../components/Badge'
// import Loader from '../components/Loader'
import { AlertCircle, Calendar } from 'lucide-react'
import { formatDate } from '../utils/formatters'

export const EventList = () => {
  const { user } = useAuth()
  const [events, setEvents] = useState<Event[]>([])
  const [isLoading, setIsLoading] = useState(true)
  const [error, setError] = useState('')

  useEffect(() => {
    loadEvents()
  }, [])

  const loadEvents = async () => {
    try {
      const response = await eventsApi.listEvents()
      setEvents(response.data.data)
      setError('')
    } catch (err: any) {
      setError('Failed to load events')
      console.error(err)
    } finally {
      setIsLoading(false)
    }
  }

  // if (isLoading) return <Loader />

  return (
    <div>
      <div className="flex justify-between items-center mb-8">
        <h1 className="text-3xl font-bold text-gray-900">Events</h1>
        {user?.role === 'ORGANIZER' && (
          <Link
            to="/events/create"
            className="bg-primary-600 text-white px-6 py-2 rounded-lg hover:bg-primary-700"
          >
            Create Event
          </Link>
        )}
      </div>

      {error && (
        <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-6 flex gap-3">
          <AlertCircle className="w-5 h-5 text-red-600 flex-shrink-0" />
          <p className="text-red-800">{error}</p>
        </div>
      )}

      {isLoading && (
        <div className="text-center py-12">
          <p className="text-gray-500 text-lg">Loading events...</p>
        </div>
      )}

      {!isLoading && events.length === 0 ? (
        <div className="text-center py-12">
          <p className="text-gray-500 text-lg">No events yet</p>
        </div>
      ) : !isLoading ? (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {events.map(event => (
            <Link
              key={event._id}
              to={`/events/${event._id}`}
              onClick={() => console.log('[EventList] link click', { id: event._id })}
              className="block bg-white rounded-lg shadow hover:shadow-lg transition-shadow h-full p-6 border border-gray-200 hover:border-primary-300 no-underline text-inherit"
            >
              <div className="flex justify-between items-start mb-3">
                <h3 className="text-xl font-bold text-gray-900 flex-1">{event.title}</h3>
                <Badge status={event.status} />
              </div>
              <p className="text-gray-600 text-sm mb-4 line-clamp-2">{event.description}</p>
              <div className="flex items-center gap-2 text-gray-600 text-sm mb-4">
                <Calendar className="w-4 h-4" />
                <span>{formatDate(event.startDate)} – {formatDate(event.endDate)}</span>
              </div>
              <div className="flex gap-2 flex-wrap">
                {event.hasSubmissions && <span className="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">Submissions</span>}
                {event.hasJudging && <span className="text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded">Judging</span>}
              </div>
            </Link>
          ))}
        </div>
      ) : null}
    </div>
  )
}

export default EventList


// ============================================
// FILE: src/index.css
// ============================================
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  * {
    @apply selection:bg-primary-100 selection:text-primary-900;
  }

  body {
    @apply bg-gray-50 text-gray-900;
  }

  h1, h2, h3, h4, h5, h6 {
    @apply font-semibold;
  }

  input[type="text"],
  input[type="email"],
  input[type="password"],
  input[type="number"],
  select,
  textarea {
    @apply transition-colors;
  }
}

@layer components {
  .transition-smooth {
    @apply transition-all duration-200 ease-in-out;
  }

  .shadow-card {
    @apply shadow-sm;
  }

  .border-card {
    @apply border border-gray-200;
  }
}

/* Scrollbar styling */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: #d1d5db;
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: #9ca3af;
}


// ============================================
// FILE: src/layout/Navbar.tsx
// ============================================
import { Link } from 'react-router-dom'
import { useAuth } from '../auth/AuthContext'
import { authApi } from '../api/auth.api'
import { useNavigate } from 'react-router-dom'
import Button from '../components/Button'

export const Navbar = () => {
  const { user, setUser, setAccessToken } = useAuth()
  const navigate = useNavigate()

  const handleLogout = async () => {
    try {
      await authApi.logout()
    } catch (err) {
      console.error('Logout error:', err)
    } finally {
      authApi.clearAuth()
      setUser(null)
      setAccessToken(null)
      navigate('/login')
    }
  }

  return (
    <nav className="bg-white border-b border-gray-200 sticky top-0 z-40">
      <div className="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
        <Link to="/events" className="text-xl font-bold text-primary-600">
          Atria
        </Link>

        <div className="flex items-center gap-6">
          {user ? (
            <>
              <Link
                to="/events"
                className="text-gray-700 hover:text-primary-600 font-medium"
              >
                Events
              </Link>
              {user.role === 'ORGANIZER' && (
                <Link
                  to="/events/create"
                  className="text-gray-700 hover:text-primary-600 font-medium"
                >
                  Create Event
                </Link>
              )}
              <div className="flex items-center gap-3">
                <span className="text-sm text-gray-600">{user.name}</span>
                <Button
                  variant="ghost"
                  size="sm"
                  onClick={handleLogout}
                >
                  Logout
                </Button>
              </div>
            </>
          ) : (
            <>
              <Link
                to="/login"
                className="text-gray-700 hover:text-primary-600 font-medium"
              >
                Sign In
              </Link>
              <Link
                to="/register"
                className="bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700"
              >
                Sign Up
              </Link>
            </>
          )}
        </div>
      </div>
    </nav>
  )
}

export default Navbar


// ============================================
// FILE: src/layout/PageLayout.tsx
// ============================================
import { Outlet } from 'react-router-dom'
import Navbar from './Navbar'

export const PageLayout = () => {
  return (
    <div className="min-h-screen bg-gray-50">
      <Navbar />
      <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <Outlet />
      </main>
    </div>
  )
}

export default PageLayout


// ============================================
// FILE: src/main.tsx
// ============================================
import React from 'react'
import ReactDOM from 'react-dom/client'
import { BrowserRouter } from 'react-router-dom'
import './index.css'
import App from './App'

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <BrowserRouter>
      <App />
    </BrowserRouter>
  </React.StrictMode>
)


// ============================================
// FILE: src/routes.tsx
// ============================================
import { RouteObject } from 'react-router-dom'
import { UserRole } from './types/index'

import PageLayout from './layout/PageLayout'
import ProtectedRoute from './components/ProtectedRoute'
import Login from './auth/Login'
import Register from './auth/Register'
import EventList from './events/EventList'
import EventDetails from './events/EventDetails'
import CreateEvent from './events/CreateEvent'
import MySubmissions from './submissions/MySubmissions'
import SubmissionEditor from './submissions/SubmissionEditor'

export const routes: RouteObject[] = [
  {
    path: '/login',
    element: <Login />
  },
  {
    path: '/register',
    element: <Register />
  },
  {
    element: <PageLayout />,
    children: [
      {
        path: '/',
        element: (
          <ProtectedRoute>
            <EventList />
          </ProtectedRoute>
        )
      },
      {
        path: '/events',
        element: (
          <ProtectedRoute>
            <EventList />
          </ProtectedRoute>
        )
      },
      {
        path: '/events/create',
        element: (
          <ProtectedRoute allowedRoles={[UserRole.ORGANIZER]}>
            <CreateEvent />
          </ProtectedRoute>
        )
      },
      {
        path: '/events/:eventId',
        element: (
          <ProtectedRoute>
            <EventDetails />
          </ProtectedRoute>
        )
      },
      {
        path: '/events/:eventId/my-submissions',
        element: (
          <ProtectedRoute allowedRoles={[UserRole.PARTICIPANT]}>
            <MySubmissions />
          </ProtectedRoute>
        )
      },
      {
        path: '/events/:eventId/my-submissions/:submissionId',
        element: (
          <ProtectedRoute allowedRoles={[UserRole.PARTICIPANT]}>
            <SubmissionEditor />
          </ProtectedRoute>
        )
      }
    ]
  }
]


// ============================================
// FILE: src/submissions/CreateSubmission.tsx
// ============================================
import { useState } from 'react'
import { submissionsApi } from '../api/submissions.api'
import { ContentType } from '../types'
import Button from '../components/Button'
import Input from '../components/Input'
import { AlertCircle } from 'lucide-react'
import { getErrorMessage } from '../utils/formatters'

interface CreateSubmissionFormProps {
  eventId: string
  onSuccess: () => void
}

const CONTENT_TYPES = [
  { value: 'ABSTRACT', label: 'Abstract' },
  { value: 'PAPER', label: 'Paper' },
  { value: 'FILE', label: 'File Upload' },
  { value: 'LINK', label: 'Link' },
  { value: 'CUSTOM', label: 'Custom' }
]

const CreateSubmissionForm = ({ eventId, onSuccess }: CreateSubmissionFormProps) => {
  const [formData, setFormData] = useState({
    title: '',
    description: '',
    contentType: 'CUSTOM' as ContentType
  })
  const [error, setError] = useState('')
  const [isLoading, setIsLoading] = useState(false)

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {
    const { name, value } = e.target
    setFormData(prev => ({ ...prev, [name]: value }))
  }

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setError('')
    setIsLoading(true)

    try {
      await submissionsApi.createSubmission(eventId, formData)
      onSuccess()
    } catch (err: any) {
      setError(getErrorMessage(err))
    } finally {
      setIsLoading(false)
    }
  }

  return (
    <form onSubmit={handleSubmit} className="space-y-4">
      {error && (
        <div className="bg-red-50 border border-red-200 rounded-lg p-4 flex gap-3">
          <AlertCircle className="w-5 h-5 text-red-600 flex-shrink-0" />
          <p className="text-red-800">{error}</p>
        </div>
      )}

      <Input
        label="Title"
        type="text"
        name="title"
        value={formData.title}
        onChange={handleChange}
        required
      />

      <div>
        <label className="block text-sm font-medium text-gray-700 mb-2">
          Description
        </label>
        <textarea
          name="description"
          value={formData.description}
          onChange={handleChange}
          rows={4}
          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"
          required
        />
      </div>

      <div>
        <label className="block text-sm font-medium text-gray-700 mb-2">
          Content Type
        </label>
        <select
          name="contentType"
          value={formData.contentType}
          onChange={handleChange}
          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"
        >
          {CONTENT_TYPES.map(t => (
            <option key={t.value} value={t.value}>{t.label}</option>
          ))}
        </select>
      </div>

      <div className="flex gap-3 pt-4 border-t">
        <Button type="submit" variant="primary" isLoading={isLoading}>
          Create Submission
        </Button>
      </div>
    </form>
  )
}

export default CreateSubmissionForm


// ============================================
// FILE: src/submissions/MySubmissions.tsx
// ============================================
import { useEffect, useState } from 'react'
import { useParams } from 'react-router-dom'
import { submissionsApi } from '../api/submissions.api'
import { Submission } from '../types'
import Badge from '../components/Badge'
import Button from '../components/Button'
// import Loader from '../components/Loader'
import Modal from '../components/Modal'
import { AlertCircle, Plus } from 'lucide-react'
import { getErrorMessage, formatDate } from '../utils/formatters'
import { Link } from 'react-router-dom'
import CreateSubmissionForm from './CreateSubmission'

export const MySubmissions = () => {
  const { id } = useParams<{ id: string }>()
  const [submissions, setSubmissions] = useState<Submission[]>([])
  const [isLoading, setIsLoading] = useState(true)
  const [error, setError] = useState('')
  const [showCreateModal, setShowCreateModal] = useState(false)

  useEffect(() => {
    loadSubmissions()
  }, [id])

  const loadSubmissions = async () => {
    if (!id) return
    try {
      const res = await submissionsApi.listMySubmissions(id)
      setSubmissions(res.data.data)
    } catch (err: any) {
      setError(getErrorMessage(err))
    } finally {
      setIsLoading(false)
    }
  }

  const handleSubmissionCreated = () => {
    setShowCreateModal(false)
    loadSubmissions()
  }

  // if (isLoading) return <Loader />

  return (
    <div>
      <div className="flex justify-between items-center mb-8">
        <h1 className="text-3xl font-bold text-gray-900">My Submissions</h1>
        <Button
          variant="primary"
          onClick={() => setShowCreateModal(true)}
        >
          <Plus className="w-4 h-4" />
          New Submission
        </Button>
      </div>

      {error && (
        <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-6 flex gap-3">
          <AlertCircle className="w-5 h-5 text-red-600 flex-shrink-0" />
          <p className="text-red-800">{error}</p>
        </div>
      )}

      {submissions.length === 0 ? (
        <div className="text-center py-12 bg-white rounded-lg">
          <p className="text-gray-500 text-lg">No submissions yet</p>
        </div>
      ) : (
        <div className="space-y-4">
          {submissions.map(sub => (
            <Link key={sub._id} to={`/events/${id}/my-submissions/${sub._id}`}>
              <div className="bg-white rounded-lg shadow hover:shadow-lg transition-shadow p-6 border border-gray-200">
                <div className="flex justify-between items-start mb-3">
                  <div>
                    <h3 className="text-lg font-bold text-gray-900">{sub.title}</h3>
                    <p className="text-gray-600 text-sm">{sub.description}</p>
                  </div>
                  <Badge status={sub.status} />
                </div>
                <div className="flex gap-4 text-sm text-gray-600">
                  <span>Type: {sub.contentType}</span>
                  {sub.submittedAt && <span>Submitted: {formatDate(sub.submittedAt)}</span>}
                </div>
              </div>
            </Link>
          ))}
        </div>
      )}

      <Modal
        isOpen={showCreateModal}
        onClose={() => setShowCreateModal(false)}
        title="Create New Submission"
        size="lg"
      >
        <CreateSubmissionForm
          eventId={id || ''}
          onSuccess={handleSubmissionCreated}
        />
      </Modal>
    </div>
  )
}

export default MySubmissions


// ============================================
// FILE: src/submissions/SubmissionEditor.tsx
// ============================================
import { useEffect, useState } from 'react'
import { useParams, useNavigate } from 'react-router-dom'
import { submissionsApi } from '../api/submissions.api'
import { Submission, SubmissionStatus } from '../types'
import Button from '../components/Button'
import Input from '../components/Input'
// import Loader from '../components/Loader'
import { AlertCircle, ChevronLeft } from 'lucide-react'
import { getErrorMessage } from '../utils/formatters'

interface EditableSubmission {
  title?: string
  description?: string
  content?: string
}

const SubmissionEditor = () => {
  const { eventId, submissionId } = useParams<{ eventId: string; submissionId: string }>()
  const navigate = useNavigate()

  const [submission, setSubmission] = useState<Submission | null>(null)
  const [editData, setEditData] = useState<EditableSubmission>({})
  const [error, setError] = useState('')
  const [isLoading, setIsLoading] = useState(true)
  const [isSaving, setIsSaving] = useState(false)
  const [isSubmitting, setIsSubmitting] = useState(false)

  useEffect(() => {
    const loadSubmission = async () => {
      try {
        setIsLoading(true)
        const response = await submissionsApi.getSubmission(eventId!, submissionId!)
        const data = response.data.data
        setSubmission(data)
        setEditData({
          title: data.title,
          description: data.description,
          content: data.content || ''
        })
      } catch (err) {
        setError(getErrorMessage(err))
      } finally {
        setIsLoading(false)
      }
    }

    if (eventId && submissionId) {
      loadSubmission()
    }
  }, [eventId, submissionId])

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {
    const { name, value } = e.target
    setEditData(prev => ({ ...prev, [name]: value }))
  }

  const handleSave = async () => {
    if (!submission) return
    setError('')
    setIsSaving(true)

    try {
      const response = await submissionsApi.updateSubmission(eventId!, submissionId!, editData)
      const updated = response.data.data
      setSubmission(updated)
    } catch (err) {
      setError(getErrorMessage(err))
    } finally {
      setIsSaving(false)
    }
  }

  const handleSubmit = async () => {
    if (!submission) return
    setError('')
    setIsSubmitting(true)

    try {
      const response = await submissionsApi.submitSubmission(eventId!, submissionId!)
      const updated = response.data.data
      setSubmission(updated)
    } catch (err) {
      setError(getErrorMessage(err))
    } finally {
      setIsSubmitting(false)
    }
  }

  // if (isLoading) {
  //   return (
  //     <div className="flex items-center justify-center py-12">
  //       {/* <Loader /> */}
  //     </div>
  //   )
  // }

  if (!submission) {
    return (
      <div className="bg-red-50 border border-red-200 rounded-lg p-6 text-center">
        <p className="text-red-800">Submission not found</p>
        <Button
          variant="secondary"
          onClick={() => navigate(`/events/${eventId}/my-submissions`)}
          className="mt-4"
        >
          Back to Submissions
        </Button>
      </div>
    )
  }

  const isDraft = submission.status === SubmissionStatus.DRAFT
  const canEdit = isDraft

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex items-center gap-3 mb-6">
        <button
          onClick={() => navigate(`/events/${eventId}/my-submissions`)}
          className="p-2 hover:bg-gray-100 rounded-lg transition"
        >
          <ChevronLeft className="w-5 h-5" />
        </button>
        <div>
          <h1 className="text-3xl font-bold text-gray-900">{submission.title}</h1>
          <p className="text-gray-600 mt-1">
            {submission.status === SubmissionStatus.DRAFT && 'Draft'}
            {submission.status === SubmissionStatus.SUBMITTED && 'Submitted'}
            {submission.status === SubmissionStatus.UNDER_REVIEW && 'Under Review'}
            {submission.status === SubmissionStatus.APPROVED && 'Approved'}
            {submission.status === SubmissionStatus.REJECTED && 'Rejected'}
          </p>
        </div>
      </div>

      {/* Error Alert */}
      {error && (
        <div className="bg-red-50 border border-red-200 rounded-lg p-4 flex gap-3">
          <AlertCircle className="w-5 h-5 text-red-600 flex-shrink-0" />
          <p className="text-red-800">{error}</p>
        </div>
      )}

      {/* Read-only Alert for non-drafts */}
      {!isDraft && (
        <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
          <p className="text-blue-800">
            This submission cannot be edited as it has been {submission.status.toLowerCase()}.
          </p>
        </div>
      )}

      {/* Form */}
      <div className="bg-white rounded-lg border border-gray-200 p-6 space-y-4">
        <Input
          label="Title"
          type="text"
          name="title"
          value={editData.title || ''}
          onChange={handleChange}
          disabled={!canEdit}
        />

        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Description
          </label>
          <textarea
            name="description"
            value={editData.description || ''}
            onChange={handleChange}
            disabled={!canEdit}
            rows={4}
            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 disabled:bg-gray-50 disabled:text-gray-600"
          />
        </div>

        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Content
          </label>
          <textarea
            name="content"
            value={editData.content || ''}
            onChange={handleChange}
            disabled={!canEdit}
            rows={6}
            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 disabled:bg-gray-50 disabled:text-gray-600"
          />
        </div>
      </div>

      {/* Actions */}
      {canEdit && (
        <div className="flex gap-3 pt-4 border-t">
          <Button
            variant="primary"
            onClick={handleSave}
            isLoading={isSaving}
          >
            Save Draft
          </Button>
          <Button
            variant="secondary"
            onClick={handleSubmit}
            isLoading={isSubmitting}
          >
            Submit for Review
          </Button>
          <Button
            variant="ghost"
            onClick={() => navigate(`/events/${eventId}/my-submissions`)}
          >
            Cancel
          </Button>
        </div>
      )}

      {!canEdit && (
        <div className="flex gap-3 pt-4 border-t">
          <Button
            variant="ghost"
            onClick={() => navigate(`/events/${eventId}/my-submissions`)}
          >
            Back to Submissions
          </Button>
        </div>
      )}
    </div>
  )
}

export default SubmissionEditor


// ============================================
// FILE: src/types/index.ts
// ============================================
export enum EventType {
  CONFERENCE = 'CONFERENCE',
  FEST = 'FEST',
  PROGRAM = 'PROGRAM',
  CUSTOM = 'CUSTOM'
}

export enum EventStatus {
  DRAFT = 'DRAFT',
  PUBLISHED = 'PUBLISHED',
  ONGOING = 'ONGOING',
  COMPLETED = 'COMPLETED'
}

export interface Event {
  _id: string
  title: string
  description: string
  eventType: EventType
  startDate: string | Date
  endDate: string | Date
  createdBy: string
  isPublic: boolean
  status: EventStatus
  hasTeams?: boolean
  hasCategories?: boolean
  hasJudging?: boolean
  hasScoring?: boolean
  hasSubmissions?: boolean
  createdAt?: string
  updatedAt?: string
}

export enum ParticipationRole {
  PARTICIPANT = 'PARTICIPANT',
  ORGANIZER = 'ORGANIZER',
  JUDGE = 'JUDGE'
}

export enum ParticipationStatus {
  REGISTERED = 'REGISTERED',
  APPROVED = 'APPROVED',
  REJECTED = 'REJECTED',
  WITHDRAWN = 'WITHDRAWN'
}

export interface Participation {
  _id: string
  user: { _id: string; name: string; email: string; role: string }
  event: string
  role: ParticipationRole
  status: ParticipationStatus
  registeredAt: string
  createdAt?: string
  updatedAt?: string
}

export enum ContentType {
  ABSTRACT = 'ABSTRACT',
  PAPER = 'PAPER',
  FILE = 'FILE',
  LINK = 'LINK',
  CUSTOM = 'CUSTOM'
}

export enum SubmissionStatus {
  DRAFT = 'DRAFT',
  SUBMITTED = 'SUBMITTED',
  UNDER_REVIEW = 'UNDER_REVIEW',
  APPROVED = 'APPROVED',
  REJECTED = 'REJECTED'
}

export interface Submission {
  _id: string
  event: string
  participation: string
  title: string
  description: string
  contentType: ContentType
  status: SubmissionStatus
  content?: string
  submittedAt?: string | null
  files?: any[]
  links?: string[]
  meta?: any
  createdAt?: string
  updatedAt?: string
}

export enum UserRole {
  ORGANIZER = 'ORGANIZER',
  PARTICIPANT = 'PARTICIPANT',
  JUDGE = 'JUDGE'
}

export interface User {
  _id: string
  name: string
  email: string
  role: UserRole
}

export interface AuthResponse {
  success: boolean
  message?: string
  data: {
    accessToken: string
    user: User
  }
}

export interface ApiError {
  message: string
  statusCode?: number
}


// ============================================
// FILE: src/utils/formatters.ts
// ============================================
export const formatDate = (dateString: string | Date | undefined): string => {
  if (!dateString) return ''
  const date = new Date(dateString)
  return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })
}

export const formatDateTime = (dateString: string | Date | undefined): string => {
  if (!dateString) return ''
  const date = new Date(dateString)
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  })
}

export const truncateText = (text: string, length: number = 100): string => {
  return text.length > length ? text.substring(0, length) + '...' : text
}

export const getErrorMessage = (error: any): string => {
  if (error?.response?.data?.message) return error.response.data.message
  if (error?.message) return error.message
  return 'An unexpected error occurred'
}


// ============================================
// FILE: D:\Atria-Frontend\src\api\auth.api.ts
// ============================================
import axiosInstance from './axios'
import { AuthResponse, User } from '../types'

export const authApi = {
  login: (email: string, password: string) =>
    axiosInstance.post<AuthResponse>('/auth/login', { email, password }),

  register: (name: string, email: string, password: string, role: string) =>
    axiosInstance.post<AuthResponse>('/auth/register', { name, email, password, role }),

  logout: () =>
    axiosInstance.post('/auth/logout'),

  getCurrentUser: (): User | null => {
    const user = localStorage.getItem('user')
    return user ? JSON.parse(user) : null
  },

  setCurrentUser: (user: User) => {
    localStorage.setItem('user', JSON.stringify(user))
  },

  clearAuth: () => {
    localStorage.removeItem('accessToken')
    localStorage.removeItem('user')
  }
}



// ============================================
// FILE: D:\Atria-Frontend\src\api\axios.ts
// ============================================
import axios, { AxiosInstance, AxiosError, InternalAxiosRequestConfig } from 'axios'

const API_BASE = '/api'

const axiosInstance: AxiosInstance = axios.create({
  baseURL: API_BASE,
  withCredentials: true,
  headers: {
    'Content-Type': 'application/json'
  }
})

// Request interceptor: attach access token
axiosInstance.interceptors.request.use((config: InternalAxiosRequestConfig) => {
  const token = localStorage.getItem('accessToken')
  if (token) {
    config.headers.Authorization = `Bearer ${token}`
  }
  return config
})

// Response interceptor: handle 401, refresh token
let isRefreshing = false
let failedQueue: Array<(token: string) => void> = []

const processQueue = (token: string) => {
  failedQueue.forEach(cb => cb(token))
  failedQueue = []
}

axiosInstance.interceptors.response.use(
  response => response,
  async (error: AxiosError) => {
    const originalRequest = error.config as InternalAxiosRequestConfig & { _retry?: boolean }

    if (error.response?.status === 401 && !originalRequest._retry) {
      if (isRefreshing) {
        return new Promise((resolve) => {
          failedQueue.push((token: string) => {
            originalRequest.headers.Authorization = `Bearer ${token}`
            resolve(axiosInstance(originalRequest))
          })
        })
      }

      isRefreshing = true
      originalRequest._retry = true

      try {
        const response = await axios.post(
          `${API_BASE}/auth/refresh`,
          {},
          { withCredentials: true }
        )
        const newToken = response.data.data.accessToken
        localStorage.setItem('accessToken', newToken)
        processQueue(newToken)
        originalRequest.headers.Authorization = `Bearer ${newToken}`
        return axiosInstance(originalRequest)
      } catch (refreshError) {
        localStorage.removeItem('accessToken')
        window.location.href = '/login'
        return Promise.reject(refreshError)
      } finally {
        isRefreshing = false
      }
    }

    return Promise.reject(error)
  }
)

export default axiosInstance



// ============================================
// FILE: D:\Atria-Frontend\src\api\events.api.ts
// ============================================
import axiosInstance from './axios'
import { Event } from '../types'

export const eventsApi = {
  listEvents: () =>
    axiosInstance.get<{ success: boolean; data: Event[] }>('/events'),

  getEvent: (eventId: string) =>
    axiosInstance.get<{ success: boolean; data: Event }>(`/events/${eventId}`),

  createEvent: (data: Partial<Event>) =>
    axiosInstance.post<{ success: boolean; data: Event }>('/events', data),

  updateEvent: (eventId: string, data: Partial<Event>) =>
    axiosInstance.put<{ success: boolean; data: Event }>(`/events/${eventId}`, data),

  deleteEvent: (eventId: string) =>
    axiosInstance.delete<{ success: boolean; data: Event }>(`/events/${eventId}`)
}



// ============================================
// FILE: D:\Atria-Frontend\src\api\participation.api.ts
// ============================================
import axiosInstance from './axios'
import { Participation, ParticipationStatus } from '../types'

export const participationApi = {
  registerForEvent: (eventId: string) =>
    axiosInstance.post<{ success: boolean; data: Participation }>(
      `/events/${eventId}/register`
    ),

  listParticipants: (eventId: string) =>
    axiosInstance.get<{ success: boolean; data: Participation[] }>(
      `/events/${eventId}/participants`
    ),

  getMyParticipation: (eventId: string) =>
    axiosInstance.get<{ success: boolean; data: Participation | null }>(
      `/events/${eventId}/my-participation`
    ),

  updateParticipationStatus: (eventId: string, participationId: string, status: ParticipationStatus) =>
    axiosInstance.patch<{ success: boolean; data: Participation }>(
      `/events/${eventId}/participants/${participationId}`,
      { status }
    )
}



// ============================================
// FILE: D:\Atria-Frontend\src\api\submissions.api.ts
// ============================================
import axiosInstance from './axios'
import { Submission } from '../types'

export const submissionsApi = {
  getSubmission: (eventId: string, submissionId: string) =>
    axiosInstance.get<{ success: boolean; data: Submission }>(
      `/events/${eventId}/submissions/${submissionId}`
    ),

  createSubmission: (eventId: string, data: Partial<Submission>) =>
    axiosInstance.post<{ success: boolean; data: Submission }>(
      `/events/${eventId}/submissions`,
      data
    ),

  updateSubmission: (eventId: string, submissionId: string, data: Partial<Submission>) =>
    axiosInstance.put<{ success: boolean; data: Submission }>(
      `/events/${eventId}/submissions/${submissionId}`,
      data
    ),

  submitSubmission: (eventId: string, submissionId: string) =>
    axiosInstance.post<{ success: boolean; data: Submission }>(
      `/events/${eventId}/submissions/${submissionId}/submit`
    ),

  listMySubmissions: (eventId: string) =>
    axiosInstance.get<{ success: boolean; data: Submission[] }>(
      `/events/${eventId}/my-submissions`
    ),

  listSubmissions: (eventId: string) =>
    axiosInstance.get<{ success: boolean; data: Submission[] }>(
      `/events/${eventId}/submissions`
    )
}



// ============================================
// FILE: D:\Atria-Frontend\src\App.tsx
// ============================================
import { useLocation, useRoutes } from 'react-router-dom'
import { AuthProvider } from './auth/AuthContext'
import { routes } from './routes'

function App() {
  const location = useLocation()

  console.log('App - Current location:', location.pathname)

  return (
    <AuthProvider>
      <RoutesWrapper />
    </AuthProvider>
  )
}

const RoutesWrapper = () => {
  const element = useRoutes(routes)
  return element
}

export default App



// ============================================
// FILE: D:\Atria-Frontend\src\auth\AuthContext.tsx
// ============================================
import { createContext, useContext, useState, useEffect, ReactNode } from 'react'
import { User } from '../types'

interface AuthContextType {
  user: User | null
  accessToken: string | null
  isLoading: boolean
  setUser: (user: User | null) => void
  setAccessToken: (token: string | null) => void
}

const AuthContext = createContext<AuthContextType | undefined>(undefined)

export const AuthProvider = ({ children }: { children: ReactNode }) => {
  const [user, setUser] = useState<User | null>(null)
  const [accessToken, setAccessToken] = useState<string | null>(null)
  const [isLoading, setIsLoading] = useState(true)

  useEffect(() => {
    const storedUser = localStorage.getItem('user')
    const storedToken = localStorage.getItem('accessToken')
    
    if (storedUser && storedToken) {
      setUser(JSON.parse(storedUser))
      setAccessToken(storedToken)
    }
    setIsLoading(false)
  }, [])

  const value = {
    user,
    accessToken,
    isLoading,
    setUser: (newUser: User | null) => {
      setUser(newUser)
      if (newUser) {
        localStorage.setItem('user', JSON.stringify(newUser))
      } else {
        localStorage.removeItem('user')
      }
    },
    setAccessToken: (token: string | null) => {
      setAccessToken(token)
      if (token) {
        localStorage.setItem('accessToken', token)
      } else {
        localStorage.removeItem('accessToken')
      }
    }
  }

  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>
}

export const useAuth = () => {
  const context = useContext(AuthContext)
  if (!context) {
    throw new Error('useAuth must be used within AuthProvider')
  }
  return context
}



// ============================================
// FILE: D:\Atria-Frontend\src\auth\Login.tsx
// ============================================
import { useState } from 'react'
import { useNavigate } from 'react-router-dom'
import { authApi } from '../api/auth.api'
import { useAuth } from './AuthContext'
import Button from '../components/Button'
import Input from '../components/Input'
import { AlertCircle } from 'lucide-react'

export const Login = () => {
  const navigate = useNavigate()
  const { setUser, setAccessToken } = useAuth()
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [error, setError] = useState('')
  const [isLoading, setIsLoading] = useState(false)

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setError('')
    setIsLoading(true)

    try {
      const response = await authApi.login(email, password)
      const { accessToken, user } = response.data.data
      
      setAccessToken(accessToken)
      setUser(user)
      navigate('/events')
    } catch (err: any) {
      setError(err.response?.data?.message || 'Login failed. Please try again.')
    } finally {
      setIsLoading(false)
    }
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-primary-50 to-primary-100 flex items-center justify-center p-4">
      <div className="bg-white rounded-lg shadow-xl p-8 w-full max-w-md">
        <h1 className="text-3xl font-bold text-gray-900 mb-2">Atria</h1>
        <p className="text-gray-600 mb-8">Event Platform</p>

        {error && (
          <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-6 flex gap-3">
            <AlertCircle className="w-5 h-5 text-red-600 flex-shrink-0" />
            <p className="text-red-800 text-sm">{error}</p>
          </div>
        )}

        <form onSubmit={handleSubmit} className="space-y-4">
          <Input
            label="Email"
            type="email"
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            required
          />
          <Input
            label="Password"
            type="password"
            value={password}
            onChange={(e) => setPassword(e.target.value)}
            required
          />
          <Button type="submit" variant="primary" isLoading={isLoading} className="w-full">
            Sign In
          </Button>
        </form>

        <p className="text-center text-gray-600 text-sm mt-6">
          Don't have an account?{' '}
          <a href="/register" className="text-primary-600 hover:text-primary-700 font-semibold">
            Sign up
          </a>
        </p>
      </div>
    </div>
  )
}

export default Login



// ============================================
// FILE: D:\Atria-Frontend\src\auth\Register.tsx
// ============================================
import { useState } from 'react'
import { useNavigate } from 'react-router-dom'
import { authApi } from '../api/auth.api'
import { useAuth } from './AuthContext'
import Button from '../components/Button'
import Input from '../components/Input'
import { AlertCircle } from 'lucide-react'

const ROLES = [
  { value: 'ORGANIZER', label: 'Organizer' },
  { value: 'PARTICIPANT', label: 'Participant' }
]

export const Register = () => {
  const navigate = useNavigate()
  const { setUser, setAccessToken } = useAuth()
  const [formData, setFormData] = useState({ name: '', email: '', password: '', role: 'PARTICIPANT' })
  const [error, setError] = useState('')
  const [isLoading, setIsLoading] = useState(false)

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {
    setFormData(prev => ({ ...prev, [e.target.name]: e.target.value }))
  }

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setError('')
    setIsLoading(true)

    try {
      const response = await authApi.register(
        formData.name,
        formData.email,
        formData.password,
        formData.role
      )
      const { accessToken, user } = response.data.data
      
      setAccessToken(accessToken)
      setUser(user)
      navigate('/events')
    } catch (err: any) {
      setError(err.response?.data?.message || 'Registration failed. Please try again.')
    } finally {
      setIsLoading(false)
    }
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-primary-50 to-primary-100 flex items-center justify-center p-4">
      <div className="bg-white rounded-lg shadow-xl p-8 w-full max-w-md">
        <h1 className="text-3xl font-bold text-gray-900 mb-2">Join Atria</h1>
        <p className="text-gray-600 mb-8">Create your account</p>

        {error && (
          <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-6 flex gap-3">
            <AlertCircle className="w-5 h-5 text-red-600 flex-shrink-0" />
            <p className="text-red-800 text-sm">{error}</p>
          </div>
        )}

        <form onSubmit={handleSubmit} className="space-y-4">
          <Input
            label="Full Name"
            type="text"
            name="name"
            value={formData.name}
            onChange={handleChange}
            required
          />
          <Input
            label="Email"
            type="email"
            name="email"
            value={formData.email}
            onChange={handleChange}
            required
          />
          <Input
            label="Password"
            type="password"
            name="password"
            value={formData.password}
            onChange={handleChange}
            required
          />
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              Account Type
            </label>
            <select
              name="role"
              value={formData.role}
              onChange={handleChange}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"
            >
              {ROLES.map(role => (
                <option key={role.value} value={role.value}>
                  {role.label}
                </option>
              ))}
            </select>
          </div>
          <Button type="submit" variant="primary" isLoading={isLoading} className="w-full">
            Create Account
          </Button>
        </form>

        <p className="text-center text-gray-600 text-sm mt-6">
          Already have an account?{' '}
          <a href="/login" className="text-primary-600 hover:text-primary-700 font-semibold">
            Sign in
          </a>
        </p>
      </div>
    </div>
  )
}

export default Register



// ============================================
// FILE: D:\Atria-Frontend\src\components\Badge.tsx
// ============================================
import { EventStatus, SubmissionStatus, ParticipationStatus } from '../types'

const statusBadgeColors: Record<string, string> = {
  // EventStatus
  'EventStatus.DRAFT': 'bg-gray-100 text-gray-800',
  'EventStatus.PUBLISHED': 'bg-blue-100 text-blue-800',
  'EventStatus.ONGOING': 'bg-green-100 text-green-800',
  'EventStatus.COMPLETED': 'bg-gray-100 text-gray-800',
  // SubmissionStatus
  'SubmissionStatus.DRAFT': 'bg-yellow-100 text-yellow-800',
  'SubmissionStatus.SUBMITTED': 'bg-blue-100 text-blue-800',
  'SubmissionStatus.UNDER_REVIEW': 'bg-purple-100 text-purple-800',
  'SubmissionStatus.APPROVED': 'bg-green-100 text-green-800',
  'SubmissionStatus.REJECTED': 'bg-red-100 text-red-800',
  // ParticipationStatus
  'ParticipationStatus.REGISTERED': 'bg-blue-100 text-blue-800',
  'ParticipationStatus.APPROVED': 'bg-green-100 text-green-800',
  'ParticipationStatus.REJECTED': 'bg-red-100 text-red-800',
  'ParticipationStatus.WITHDRAWN': 'bg-gray-100 text-gray-800',
  // Fallbacks for string values
  [EventStatus.DRAFT]: 'bg-gray-100 text-gray-800',
  [EventStatus.PUBLISHED]: 'bg-blue-100 text-blue-800',
  [EventStatus.ONGOING]: 'bg-green-100 text-green-800',
  [EventStatus.COMPLETED]: 'bg-gray-100 text-gray-800',
  [SubmissionStatus.SUBMITTED]: 'bg-blue-100 text-blue-800',
  [SubmissionStatus.UNDER_REVIEW]: 'bg-purple-100 text-purple-800',
  [SubmissionStatus.APPROVED]: 'bg-green-100 text-green-800',
  [ParticipationStatus.REGISTERED]: 'bg-blue-100 text-blue-800',
  [ParticipationStatus.WITHDRAWN]: 'bg-gray-100 text-gray-800'
}

interface BadgeProps {
  status: string
  children?: React.ReactNode
}

const Badge = ({ status, children }: BadgeProps) => {
  const colorClass = statusBadgeColors[status] || 'bg-gray-100 text-gray-800'

  return (
    <span className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${colorClass}`}>
      {children || status}
    </span>
  )
}

export default Badge



// ============================================
// FILE: D:\Atria-Frontend\src\components\Button.tsx
// ============================================
import React from 'react'
import { Loader as LoaderIcon } from 'lucide-react'

interface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: 'primary' | 'secondary' | 'danger' | 'ghost'
  size?: 'sm' | 'md' | 'lg'
  isLoading?: boolean
  children: React.ReactNode
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ variant = 'primary', size = 'md', isLoading = false, className = '', children, disabled, ...props }, ref) => {
    const baseStyles = 'font-medium rounded-lg transition-colors inline-flex items-center justify-center gap-2'
    
    const variantStyles = {
      primary: 'bg-primary-600 text-white hover:bg-primary-700 disabled:bg-primary-300',
      secondary: 'bg-gray-200 text-gray-900 hover:bg-gray-300 disabled:bg-gray-100',
      danger: 'bg-red-600 text-white hover:bg-red-700 disabled:bg-red-300',
      ghost: 'bg-transparent text-primary-600 hover:bg-primary-50 disabled:text-primary-300'
    }

    const sizeStyles = {
      sm: 'px-3 py-1.5 text-sm',
      md: 'px-4 py-2 text-base',
      lg: 'px-6 py-3 text-lg'
    }

    return (
      <button
        ref={ref}
        disabled={disabled || isLoading}
        className={`${baseStyles} ${variantStyles[variant]} ${sizeStyles[size]} ${className}`}
        {...props}
      >
        {isLoading && <LoaderIcon className="w-4 h-4 animate-spin" />}
        {children}
      </button>
    )
  }
)

Button.displayName = 'Button'

export default Button



// ============================================
// FILE: D:\Atria-Frontend\src\components\Input.tsx
// ============================================
import React from 'react'

interface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {
  label?: string
  error?: string
}

const Input = React.forwardRef<HTMLInputElement, InputProps>(
  ({ label, error, className = '', ...props }, ref) => {
    return (
      <div className="w-full">
        {label && <label className="block text-sm font-medium text-gray-700 mb-2">{label}</label>}
        <input
          ref={ref}
          className={`w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent ${
            error ? 'border-red-500 focus:ring-red-500' : ''
          } ${className}`}
          {...props}
        />
        {error && <p className="text-red-600 text-sm mt-1">{error}</p>}
      </div>
    )
  }
)

Input.displayName = 'Input'

export default Input



// ============================================
// FILE: D:\Atria-Frontend\src\components\Loader.tsx
// ============================================
// import { Loader as LoaderIcon } from 'lucide-react'

// interface LoaderProps {
//   size?: 'sm' | 'md' | 'lg'
// }

// const Loader = ({ size = 'md' }: LoaderProps) => {
//   const sizeClasses = {
//     sm: 'w-4 h-4',
//     md: 'w-8 h-8',
//     lg: 'w-12 h-12'
//   }

//   return (
//     <div className="flex items-center justify-center">
//       <LoaderIcon className={`${sizeClasses[size]} animate-spin text-primary-600`} />
//     </div>
//   )
// }

// export default Loader



// ============================================
// FILE: D:\Atria-Frontend\src\components\Modal.tsx
// ============================================
import { ReactNode } from 'react'
import { X } from 'lucide-react'

interface ModalProps {
  isOpen: boolean
  onClose: () => void
  title: string
  children: ReactNode
  size?: 'sm' | 'md' | 'lg'
}

const Modal = ({ isOpen, onClose, title, children, size = 'md' }: ModalProps) => {
  if (!isOpen) return null

  const sizeClasses = {
    sm: 'max-w-sm',
    md: 'max-w-md',
    lg: 'max-w-2xl'
  }

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className={`bg-white rounded-lg shadow-xl w-full ${sizeClasses[size]}`}>
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-xl font-bold text-gray-900">{title}</h2>
          <button
            onClick={onClose}
            className="text-gray-500 hover:text-gray-700"
          >
            <X className="w-5 h-5" />
          </button>
        </div>
        <div className="p-6">{children}</div>
      </div>
    </div>
  )
}

export default Modal



// ============================================
// FILE: D:\Atria-Frontend\src\components\ProtectedRoute.tsx
// ============================================
import { Navigate } from 'react-router-dom'
import { useAuth } from '../auth/AuthContext'
import { UserRole } from '../types'

interface ProtectedRouteProps {
  children: React.ReactNode
  allowedRoles?: UserRole[]
}

const ProtectedRoute = ({ children, allowedRoles }: ProtectedRouteProps) => {
  const { user, isLoading } = useAuth()

  if (isLoading) {
    return (
      <div className="flex items-center justify-center h-screen">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600" />
      </div>
    )
  }

  if (!user) {
    return <Navigate to="/login" replace />
  }

  if (allowedRoles && !allowedRoles.includes(user.role)) {
    return <Navigate to="/events" replace />
  }

  return <>{children}</>
}

export default ProtectedRoute



// ============================================
// FILE: D:\Atria-Frontend\src\events\CreateEvent.tsx
// ============================================
import { useState } from 'react'
import { useNavigate } from 'react-router-dom'
import { eventsApi } from '../api/events.api'
import { EventType } from '../types'
import Button from '../components/Button'
import Input from '../components/Input'
import { AlertCircle } from 'lucide-react'
import { getErrorMessage } from '../utils/formatters'

const EVENT_TYPES = [
  { value: 'CONFERENCE', label: 'Conference' },
  { value: 'FEST', label: 'Festival' },
  { value: 'PROGRAM', label: 'Program' },
  { value: 'CUSTOM', label: 'Custom' }
]

export const CreateEvent = () => {
  const navigate = useNavigate()
  const [formData, setFormData] = useState({
    title: '',
    description: '',
    eventType: 'CONFERENCE' as EventType,
    startDate: '',
    endDate: '',
    isPublic: true,
    hasSubmissions: false,
    hasTeams: false,
    hasJudging: false,
    hasScoring: false
  })
  const [error, setError] = useState('')
  const [isLoading, setIsLoading] = useState(false)

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {
    const { name, value, type } = e.target as any
    setFormData(prev => ({
      ...prev,
      [name]: type === 'checkbox' ? (e.target as HTMLInputElement).checked : value
    }))
  }

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setError('')
    setIsLoading(true)

    try {
      const response = await eventsApi.createEvent(formData)
      navigate(`/events/${response.data.data._id}`)
    } catch (err: any) {
      setError(getErrorMessage(err))
    } finally {
      setIsLoading(false)
    }
  }

  return (
    <div className="max-w-2xl">
      <h1 className="text-3xl font-bold text-gray-900 mb-8">Create New Event</h1>

      {error && (
        <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-6 flex gap-3">
          <AlertCircle className="w-5 h-5 text-red-600 flex-shrink-0" />
          <p className="text-red-800">{error}</p>
        </div>
      )}

      <form onSubmit={handleSubmit} className="bg-white rounded-lg shadow p-8 space-y-6">
        <Input
          label="Event Title"
          type="text"
          name="title"
          value={formData.title}
          onChange={handleChange}
          required
        />

        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Description
          </label>
          <textarea
            name="description"
            value={formData.description}
            onChange={handleChange}
            rows={5}
            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"
            required
          />
        </div>

        <div className="grid grid-cols-2 gap-6">
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              Event Type
            </label>
            <select
              name="eventType"
              value={formData.eventType}
              onChange={handleChange}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"
            >
              {EVENT_TYPES.map(t => (
                <option key={t.value} value={t.value}>{t.label}</option>
              ))}
            </select>
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              Visibility
            </label>
            <select
              name="isPublic"
              value={formData.isPublic ? 'true' : 'false'}
              onChange={(e) => setFormData(prev => ({ ...prev, isPublic: e.target.value === 'true' }))}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"
            >
              <option value="true">Public</option>
              <option value="false">Private</option>
            </select>
          </div>
        </div>

        <div className="grid grid-cols-2 gap-6">
          <Input
            label="Start Date"
            type="datetime-local"
            name="startDate"
            value={formData.startDate}
            onChange={handleChange}
            required
          />
          <Input
            label="End Date"
            type="datetime-local"
            name="endDate"
            value={formData.endDate}
            onChange={handleChange}
            required
          />
        </div>

        <div className="border-t pt-6">
          <p className="text-sm font-medium text-gray-700 mb-4">Features</p>
          <div className="space-y-3">
            <label className="flex items-center gap-3">
              <input
                type="checkbox"
                name="hasSubmissions"
                checked={formData.hasSubmissions}
                onChange={handleChange}
                className="w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"
              />
              <span className="text-gray-700">Enable Submissions</span>
            </label>
            <label className="flex items-center gap-3">
              <input
                type="checkbox"
                name="hasTeams"
                checked={formData.hasTeams}
                onChange={handleChange}
                className="w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"
              />
              <span className="text-gray-700">Enable Teams</span>
            </label>
            <label className="flex items-center gap-3">
              <input
                type="checkbox"
                name="hasJudging"
                checked={formData.hasJudging}
                onChange={handleChange}
                className="w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"
              />
              <span className="text-gray-700">Enable Judging</span>
            </label>
          </div>
        </div>

        <div className="flex gap-4 pt-6 border-t">
          <Button type="submit" variant="primary" isLoading={isLoading}>
            Create Event
          </Button>
          <Button
            type="button"
            variant="secondary"
            onClick={() => navigate('/events')}
          >
            Cancel
          </Button>
        </div>
      </form>
    </div>
  )
}

export default CreateEvent



// ============================================
// FILE: D:\Atria-Frontend\src\events\EventDetails.tsx
// ============================================
import { useEffect, useState } from 'react'
import { useLocation, useParams } from 'react-router-dom'
import { eventsApi } from '../api/events.api'
import { participationApi } from '../api/participation.api'
import { Event, Participation } from '../types'
import { useAuth } from '../auth/AuthContext'
import Badge from '../components/Badge'
import Button from '../components/Button'
// import Loader from '../components/Loader'
import Modal from '../components/Modal'
import { AlertCircle, Users } from 'lucide-react'
import { formatDate, getErrorMessage } from '../utils/formatters'
import { Link } from 'react-router-dom'

export const EventDetails = () => {
  const { eventId } = useParams<{ eventId: string }>()
  const location = useLocation()

  // Fallback: also derive ID from URL path in case route params don't populate as expected
  const pathEventId = location.pathname.split('/').filter(Boolean).pop()
  const effectiveEventId = eventId || pathEventId
  const { user } = useAuth()
  const [event, setEvent] = useState<Event | null>(null)
  const [participation, setParticipation] = useState<Participation | null>(null)
  const [isLoading, setIsLoading] = useState(true)
  const [error, setError] = useState('')
  const [isRegistering, setIsRegistering] = useState(false)
  const [showParticipants, setShowParticipants] = useState(false)

  useEffect(() => {
    loadEvent(effectiveEventId)
  }, [effectiveEventId])

  const loadEvent = async (id?: string | null) => {
    console.log('[EventDetails] loadEvent start', { routeParam: eventId, pathEventId, effectiveEventId: id })

    if (!id) {
      console.error('[EventDetails] no eventId found in route params or URL path')
      setError('Invalid event URL. Event ID is missing.')
      setIsLoading(false)
      return
    }

    setIsLoading(true)

    try {
      const eventRes = await eventsApi.getEvent(id)
      console.log('[EventDetails] api response', eventRes)
      setEvent(eventRes.data.data)
      setError('')

      if (user && id) {
        try {
          const partRes = await participationApi.getMyParticipation(id)
          setParticipation(partRes.data.data)
        } catch (err) {
          setParticipation(null)
        }
      }
    } catch (err: any) {
      console.error('[EventDetails] loadEvent error', err)
      setError(getErrorMessage(err))
    } finally {
      setIsLoading(false)
    }
  }

  const handleRegister = async () => {
    if (!eventId) return
    setIsRegistering(true)
    try {
      const res = await participationApi.registerForEvent(eventId)
      setParticipation(res.data.data)
    } catch (err: any) {
      setError(getErrorMessage(err))
    } finally {
      setIsRegistering(false)
    }
  }

  // if (isLoading) return <Loader />
  if (isLoading) return <div className="text-center py-12">Loading event...</div>
  if (!event) return (
    <div className="text-center py-12">
      <p className="text-red-600 font-semibold mb-2">Event not found</p>
      {error && <p className="text-red-500 text-sm">{error}</p>}
      <Link to="/events" className="text-primary-600 hover:text-primary-700 mt-4 inline-block">
        ← Back to Events
      </Link>
    </div>
  )

  const isCreator = user?._id === event.createdBy
  const isRegistered = !!participation

  return (
    <div>
      <Link to="/events" className="text-primary-600 hover:text-primary-700 mb-6 inline-block">
        ← Back to Events
      </Link>

      {error && (
        <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-6 flex gap-3">
          <AlertCircle className="w-5 h-5 text-red-600 flex-shrink-0" />
          <p className="text-red-800">{error}</p>
        </div>
      )}

      <div className="bg-white rounded-lg shadow p-8 mb-8">
        <div className="flex justify-between items-start mb-6">
          <div>
            <h1 className="text-3xl font-bold text-gray-900 mb-2">{event.title}</h1>
            <Badge status={event.status} />
          </div>
        </div>

        <p className="text-gray-600 mb-6 text-lg">{event.description}</p>

        <div className="grid grid-cols-2 md:grid-cols-4 gap-6 mb-8 pb-8 border-b">
          <div>
            <p className="text-sm text-gray-600 mb-1">Type</p>
            <p className="font-semibold">{event.eventType}</p>
          </div>
          <div>
            <p className="text-sm text-gray-600 mb-1">Status</p>
            <Badge status={event.status} />
          </div>
          <div>
            <p className="text-sm text-gray-600 mb-1">Start Date</p>
            <p className="font-semibold">{formatDate(event.startDate)}</p>
          </div>
          <div>
            <p className="text-sm text-gray-600 mb-1">End Date</p>
            <p className="font-semibold">{formatDate(event.endDate)}</p>
          </div>
        </div>

        <div className="flex gap-4">
          {!isCreator && !isRegistered && user && (
            <Button
              variant="primary"
              onClick={handleRegister}
              isLoading={isRegistering}
            >
              Register for Event
            </Button>
          )}
          {isRegistered && (
            <div className="flex items-center gap-2 text-green-700 bg-green-50 px-4 py-2 rounded-lg">
              <span className="font-semibold">✓ Registered</span>
              <Badge status={participation?.status || ''} />
            </div>
          )}
          {isCreator && (
            <>
              <Link to={`/events/${event._id}/manage`}>
                <Button variant="secondary">Manage Event</Button>
              </Link>
              {event.hasSubmissions && (
                <Link to={`/events/${event._id}/submissions`}>
                  <Button variant="secondary">View Submissions</Button>
                </Link>
              )}
              <Button variant="secondary" onClick={() => setShowParticipants(true)}>
                <Users className="w-4 h-4" />
                View Participants
              </Button>
            </>
          )}
          {isRegistered && event.hasSubmissions && (
            <Link to={`/events/${event._id}/my-submissions`}>
              <Button variant="secondary">My Submissions</Button>
            </Link>
          )}
        </div>
      </div>

      <Modal
        isOpen={showParticipants}
        onClose={() => setShowParticipants(false)}
        title="Event Participants"
        size="lg"
      >
        <ParticipantsList eventId={event._id} />
      </Modal>
    </div>
  )
}

const ParticipantsList = ({ eventId }: { eventId: string }) => {
  const [participants, setParticipants] = useState<Participation[]>([])
  const [isLoading, setIsLoading] = useState(true)

  useEffect(() => {
    participationApi.listParticipants(eventId)
      .then(res => setParticipants(res.data.data))
      .finally(() => setIsLoading(false))
  }, [eventId])

  // if (isLoading) return <Loader />
  if (isLoading) return <div className="text-center py-4">Loading participants...</div>

  return (
    <div className="space-y-3">
      {participants.map(p => (
        <div key={p._id} className="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
          <div>
            <p className="font-semibold">{p.user.name}</p>
            <p className="text-sm text-gray-600">{p.user.email}</p>
          </div>
          <div className="flex gap-2">
            <Badge status={p.status} />
          </div>
        </div>
      ))}
    </div>
  )
}

export default EventDetails



// ============================================
// FILE: D:\Atria-Frontend\src\events\EventList.tsx
// ============================================
import { useEffect, useState } from 'react'
import { eventsApi } from '../api/events.api'
import { Event } from '../types'
import { Link } from 'react-router-dom'
import { useAuth } from '../auth/AuthContext'
import Badge from '../components/Badge'
// import Loader from '../components/Loader'
import { AlertCircle, Calendar } from 'lucide-react'
import { formatDate } from '../utils/formatters'

export const EventList = () => {
  const { user } = useAuth()
  const [events, setEvents] = useState<Event[]>([])
  const [isLoading, setIsLoading] = useState(true)
  const [error, setError] = useState('')

  useEffect(() => {
    loadEvents()
  }, [])

  const loadEvents = async () => {
    try {
      const response = await eventsApi.listEvents()
      setEvents(response.data.data)
      setError('')
    } catch (err: any) {
      setError('Failed to load events')
      console.error(err)
    } finally {
      setIsLoading(false)
    }
  }

  // if (isLoading) return <Loader />

  return (
    <div>
      <div className="flex justify-between items-center mb-8">
        <h1 className="text-3xl font-bold text-gray-900">Events</h1>
        {user?.role === 'ORGANIZER' && (
          <Link
            to="/events/create"
            className="bg-primary-600 text-white px-6 py-2 rounded-lg hover:bg-primary-700"
          >
            Create Event
          </Link>
        )}
      </div>

      {error && (
        <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-6 flex gap-3">
          <AlertCircle className="w-5 h-5 text-red-600 flex-shrink-0" />
          <p className="text-red-800">{error}</p>
        </div>
      )}

      {isLoading && (
        <div className="text-center py-12">
          <p className="text-gray-500 text-lg">Loading events...</p>
        </div>
      )}

      {!isLoading && events.length === 0 ? (
        <div className="text-center py-12">
          <p className="text-gray-500 text-lg">No events yet</p>
        </div>
      ) : !isLoading ? (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {events.map(event => (
            <Link
              key={event._id}
              to={`/events/${event._id}`}
              onClick={() => console.log('[EventList] link click', { id: event._id })}
              className="block bg-white rounded-lg shadow hover:shadow-lg transition-shadow h-full p-6 border border-gray-200 hover:border-primary-300 no-underline text-inherit"
            >
              <div className="flex justify-between items-start mb-3">
                <h3 className="text-xl font-bold text-gray-900 flex-1">{event.title}</h3>
                <Badge status={event.status} />
              </div>
              <p className="text-gray-600 text-sm mb-4 line-clamp-2">{event.description}</p>
              <div className="flex items-center gap-2 text-gray-600 text-sm mb-4">
                <Calendar className="w-4 h-4" />
                <span>{formatDate(event.startDate)} – {formatDate(event.endDate)}</span>
              </div>
              <div className="flex gap-2 flex-wrap">
                {event.hasSubmissions && <span className="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">Submissions</span>}
                {event.hasJudging && <span className="text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded">Judging</span>}
              </div>
            </Link>
          ))}
        </div>
      ) : null}
    </div>
  )
}

export default EventList



// ============================================
// FILE: D:\Atria-Frontend\src\index.css
// ============================================
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  * {
    @apply selection:bg-primary-100 selection:text-primary-900;
  }

  body {
    @apply bg-gray-50 text-gray-900;
  }

  h1, h2, h3, h4, h5, h6 {
    @apply font-semibold;
  }

  input[type="text"],
  input[type="email"],
  input[type="password"],
  input[type="number"],
  select,
  textarea {
    @apply transition-colors;
  }
}

@layer components {
  .transition-smooth {
    @apply transition-all duration-200 ease-in-out;
  }

  .shadow-card {
    @apply shadow-sm;
  }

  .border-card {
    @apply border border-gray-200;
  }
}

/* Scrollbar styling */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: #d1d5db;
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: #9ca3af;
}



// ============================================
// FILE: D:\Atria-Frontend\src\layout\Navbar.tsx
// ============================================
import { Link } from 'react-router-dom'
import { useAuth } from '../auth/AuthContext'
import { authApi } from '../api/auth.api'
import { useNavigate } from 'react-router-dom'
import Button from '../components/Button'

export const Navbar = () => {
  const { user, setUser, setAccessToken } = useAuth()
  const navigate = useNavigate()

  const handleLogout = async () => {
    try {
      await authApi.logout()
    } catch (err) {
      console.error('Logout error:', err)
    } finally {
      authApi.clearAuth()
      setUser(null)
      setAccessToken(null)
      navigate('/login')
    }
  }

  return (
    <nav className="bg-white border-b border-gray-200 sticky top-0 z-40">
      <div className="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
        <Link to="/events" className="text-xl font-bold text-primary-600">
          Atria
        </Link>

        <div className="flex items-center gap-6">
          {user ? (
            <>
              <Link
                to="/events"
                className="text-gray-700 hover:text-primary-600 font-medium"
              >
                Events
              </Link>
              {user.role === 'ORGANIZER' && (
                <Link
                  to="/events/create"
                  className="text-gray-700 hover:text-primary-600 font-medium"
                >
                  Create Event
                </Link>
              )}
              <div className="flex items-center gap-3">
                <span className="text-sm text-gray-600">{user.name}</span>
                <Button
                  variant="ghost"
                  size="sm"
                  onClick={handleLogout}
                >
                  Logout
                </Button>
              </div>
            </>
          ) : (
            <>
              <Link
                to="/login"
                className="text-gray-700 hover:text-primary-600 font-medium"
              >
                Sign In
              </Link>
              <Link
                to="/register"
                className="bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700"
              >
                Sign Up
              </Link>
            </>
          )}
        </div>
      </div>
    </nav>
  )
}

export default Navbar



// ============================================
// FILE: D:\Atria-Frontend\src\layout\PageLayout.tsx
// ============================================
import { Outlet } from 'react-router-dom'
import Navbar from './Navbar'

export const PageLayout = () => {
  return (
    <div className="min-h-screen bg-gray-50">
      <Navbar />
      <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <Outlet />
      </main>
    </div>
  )
}

export default PageLayout



// ============================================
// FILE: D:\Atria-Frontend\src\main.tsx
// ============================================
import React from 'react'
import ReactDOM from 'react-dom/client'
import { BrowserRouter } from 'react-router-dom'
import './index.css'
import App from './App'

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <BrowserRouter>
      <App />
    </BrowserRouter>
  </React.StrictMode>
)



// ============================================
// FILE: D:\Atria-Frontend\src\routes.tsx
// ============================================
import { RouteObject } from 'react-router-dom'
import { UserRole } from './types/index'

import PageLayout from './layout/PageLayout'
import ProtectedRoute from './components/ProtectedRoute'
import Login from './auth/Login'
import Register from './auth/Register'
import EventList from './events/EventList'
import EventDetails from './events/EventDetails'
import CreateEvent from './events/CreateEvent'
import MySubmissions from './submissions/MySubmissions'
import SubmissionEditor from './submissions/SubmissionEditor'

export const routes: RouteObject[] = [
  {
    path: '/login',
    element: <Login />
  },
  {
    path: '/register',
    element: <Register />
  },
  {
    element: <PageLayout />,
    children: [
      {
        path: '/',
        element: (
          <ProtectedRoute>
            <EventList />
          </ProtectedRoute>
        )
      },
      {
        path: '/events',
        element: (
          <ProtectedRoute>
            <EventList />
          </ProtectedRoute>
        )
      },
      {
        path: '/events/create',
        element: (
          <ProtectedRoute allowedRoles={[UserRole.ORGANIZER]}>
            <CreateEvent />
          </ProtectedRoute>
        )
      },
      {
        path: '/events/:eventId',
        element: (
          <ProtectedRoute>
            <EventDetails />
          </ProtectedRoute>
        )
      },
      {
        path: '/events/:eventId/my-submissions',
        element: (
          <ProtectedRoute allowedRoles={[UserRole.PARTICIPANT]}>
            <MySubmissions />
          </ProtectedRoute>
        )
      },
      {
        path: '/events/:eventId/my-submissions/:submissionId',
        element: (
          <ProtectedRoute allowedRoles={[UserRole.PARTICIPANT]}>
            <SubmissionEditor />
          </ProtectedRoute>
        )
      }
    ]
  }
]



// ============================================
// FILE: D:\Atria-Frontend\src\submissions\CreateSubmission.tsx
// ============================================
import { useState } from 'react'
import { submissionsApi } from '../api/submissions.api'
import { ContentType } from '../types'
import Button from '../components/Button'
import Input from '../components/Input'
import { AlertCircle } from 'lucide-react'
import { getErrorMessage } from '../utils/formatters'

interface CreateSubmissionFormProps {
  eventId: string
  onSuccess: () => void
}

const CONTENT_TYPES = [
  { value: 'ABSTRACT', label: 'Abstract' },
  { value: 'PAPER', label: 'Paper' },
  { value: 'FILE', label: 'File Upload' },
  { value: 'LINK', label: 'Link' },
  { value: 'CUSTOM', label: 'Custom' }
]

const CreateSubmissionForm = ({ eventId, onSuccess }: CreateSubmissionFormProps) => {
  const [formData, setFormData] = useState({
    title: '',
    description: '',
    contentType: 'CUSTOM' as ContentType
  })
  const [error, setError] = useState('')
  const [isLoading, setIsLoading] = useState(false)

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {
    const { name, value } = e.target
    setFormData(prev => ({ ...prev, [name]: value }))
  }

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setError('')
    setIsLoading(true)

    try {
      await submissionsApi.createSubmission(eventId, formData)
      onSuccess()
    } catch (err: any) {
      setError(getErrorMessage(err))
    } finally {
      setIsLoading(false)
    }
  }

  return (
    <form onSubmit={handleSubmit} className="space-y-4">
      {error && (
        <div className="bg-red-50 border border-red-200 rounded-lg p-4 flex gap-3">
          <AlertCircle className="w-5 h-5 text-red-600 flex-shrink-0" />
          <p className="text-red-800">{error}</p>
        </div>
      )}

      <Input
        label="Title"
        type="text"
        name="title"
        value={formData.title}
        onChange={handleChange}
        required
      />

      <div>
        <label className="block text-sm font-medium text-gray-700 mb-2">
          Description
        </label>
        <textarea
          name="description"
          value={formData.description}
          onChange={handleChange}
          rows={4}
          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"
          required
        />
      </div>

      <div>
        <label className="block text-sm font-medium text-gray-700 mb-2">
          Content Type
        </label>
        <select
          name="contentType"
          value={formData.contentType}
          onChange={handleChange}
          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"
        >
          {CONTENT_TYPES.map(t => (
            <option key={t.value} value={t.value}>{t.label}</option>
          ))}
        </select>
      </div>

      <div className="flex gap-3 pt-4 border-t">
        <Button type="submit" variant="primary" isLoading={isLoading}>
          Create Submission
        </Button>
      </div>
    </form>
  )
}

export default CreateSubmissionForm



// ============================================
// FILE: D:\Atria-Frontend\src\submissions\MySubmissions.tsx
// ============================================
import { useEffect, useState } from 'react'
import { useParams } from 'react-router-dom'
import { submissionsApi } from '../api/submissions.api'
import { Submission } from '../types'
import Badge from '../components/Badge'
import Button from '../components/Button'
// import Loader from '../components/Loader'
import Modal from '../components/Modal'
import { AlertCircle, Plus } from 'lucide-react'
import { getErrorMessage, formatDate } from '../utils/formatters'
import { Link } from 'react-router-dom'
import CreateSubmissionForm from './CreateSubmission'

export const MySubmissions = () => {
  const { id } = useParams<{ id: string }>()
  const [submissions, setSubmissions] = useState<Submission[]>([])
  const [isLoading, setIsLoading] = useState(true)
  const [error, setError] = useState('')
  const [showCreateModal, setShowCreateModal] = useState(false)

  useEffect(() => {
    loadSubmissions()
  }, [id])

  const loadSubmissions = async () => {
    if (!id) return
    try {
      const res = await submissionsApi.listMySubmissions(id)
      setSubmissions(res.data.data)
    } catch (err: any) {
      setError(getErrorMessage(err))
    } finally {
      setIsLoading(false)
    }
  }

  const handleSubmissionCreated = () => {
    setShowCreateModal(false)
    loadSubmissions()
  }

  // if (isLoading) return <Loader />

  return (
    <div>
      <div className="flex justify-between items-center mb-8">
        <h1 className="text-3xl font-bold text-gray-900">My Submissions</h1>
        <Button
          variant="primary"
          onClick={() => setShowCreateModal(true)}
        >
          <Plus className="w-4 h-4" />
          New Submission
        </Button>
      </div>

      {error && (
        <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-6 flex gap-3">
          <AlertCircle className="w-5 h-5 text-red-600 flex-shrink-0" />
          <p className="text-red-800">{error}</p>
        </div>
      )}

      {submissions.length === 0 ? (
        <div className="text-center py-12 bg-white rounded-lg">
          <p className="text-gray-500 text-lg">No submissions yet</p>
        </div>
      ) : (
        <div className="space-y-4">
          {submissions.map(sub => (
            <Link key={sub._id} to={`/events/${id}/my-submissions/${sub._id}`}>
              <div className="bg-white rounded-lg shadow hover:shadow-lg transition-shadow p-6 border border-gray-200">
                <div className="flex justify-between items-start mb-3">
                  <div>
                    <h3 className="text-lg font-bold text-gray-900">{sub.title}</h3>
                    <p className="text-gray-600 text-sm">{sub.description}</p>
                  </div>
                  <Badge status={sub.status} />
                </div>
                <div className="flex gap-4 text-sm text-gray-600">
                  <span>Type: {sub.contentType}</span>
                  {sub.submittedAt && <span>Submitted: {formatDate(sub.submittedAt)}</span>}
                </div>
              </div>
            </Link>
          ))}
        </div>
      )}

      <Modal
        isOpen={showCreateModal}
        onClose={() => setShowCreateModal(false)}
        title="Create New Submission"
        size="lg"
      >
        <CreateSubmissionForm
          eventId={id || ''}
          onSuccess={handleSubmissionCreated}
        />
      </Modal>
    </div>
  )
}

export default MySubmissions



// ============================================
// FILE: D:\Atria-Frontend\src\submissions\SubmissionEditor.tsx
// ============================================
import { useEffect, useState } from 'react'
import { useParams, useNavigate } from 'react-router-dom'
import { submissionsApi } from '../api/submissions.api'
import { Submission, SubmissionStatus } from '../types'
import Button from '../components/Button'
import Input from '../components/Input'
// import Loader from '../components/Loader'
import { AlertCircle, ChevronLeft } from 'lucide-react'
import { getErrorMessage } from '../utils/formatters'

interface EditableSubmission {
  title?: string
  description?: string
  content?: string
}

const SubmissionEditor = () => {
  const { eventId, submissionId } = useParams<{ eventId: string; submissionId: string }>()
  const navigate = useNavigate()

  const [submission, setSubmission] = useState<Submission | null>(null)
  const [editData, setEditData] = useState<EditableSubmission>({})
  const [error, setError] = useState('')
  const [isLoading, setIsLoading] = useState(true)
  const [isSaving, setIsSaving] = useState(false)
  const [isSubmitting, setIsSubmitting] = useState(false)

  useEffect(() => {
    const loadSubmission = async () => {
      try {
        setIsLoading(true)
        const response = await submissionsApi.getSubmission(eventId!, submissionId!)
        const data = response.data.data
        setSubmission(data)
        setEditData({
          title: data.title,
          description: data.description,
          content: data.content || ''
        })
      } catch (err) {
        setError(getErrorMessage(err))
      } finally {
        setIsLoading(false)
      }
    }

    if (eventId && submissionId) {
      loadSubmission()
    }
  }, [eventId, submissionId])

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {
    const { name, value } = e.target
    setEditData(prev => ({ ...prev, [name]: value }))
  }

  const handleSave = async () => {
    if (!submission) return
    setError('')
    setIsSaving(true)

    try {
      const response = await submissionsApi.updateSubmission(eventId!, submissionId!, editData)
      const updated = response.data.data
      setSubmission(updated)
    } catch (err) {
      setError(getErrorMessage(err))
    } finally {
      setIsSaving(false)
    }
  }

  const handleSubmit = async () => {
    if (!submission) return
    setError('')
    setIsSubmitting(true)

    try {
      const response = await submissionsApi.submitSubmission(eventId!, submissionId!)
      const updated = response.data.data
      setSubmission(updated)
    } catch (err) {
      setError(getErrorMessage(err))
    } finally {
      setIsSubmitting(false)
    }
  }

  // if (isLoading) {
  //   return (
  //     <div className="flex items-center justify-center py-12">
  //       {/* <Loader /> */}
  //     </div>
  //   )
  // }

  if (!submission) {
    return (
      <div className="bg-red-50 border border-red-200 rounded-lg p-6 text-center">
        <p className="text-red-800">Submission not found</p>
        <Button
          variant="secondary"
          onClick={() => navigate(`/events/${eventId}/my-submissions`)}
          className="mt-4"
        >
          Back to Submissions
        </Button>
      </div>
    )
  }

  const isDraft = submission.status === SubmissionStatus.DRAFT
  const canEdit = isDraft

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex items-center gap-3 mb-6">
        <button
          onClick={() => navigate(`/events/${eventId}/my-submissions`)}
          className="p-2 hover:bg-gray-100 rounded-lg transition"
        >
          <ChevronLeft className="w-5 h-5" />
        </button>
        <div>
          <h1 className="text-3xl font-bold text-gray-900">{submission.title}</h1>
          <p className="text-gray-600 mt-1">
            {submission.status === SubmissionStatus.DRAFT && 'Draft'}
            {submission.status === SubmissionStatus.SUBMITTED && 'Submitted'}
            {submission.status === SubmissionStatus.UNDER_REVIEW && 'Under Review'}
            {submission.status === SubmissionStatus.APPROVED && 'Approved'}
            {submission.status === SubmissionStatus.REJECTED && 'Rejected'}
          </p>
        </div>
      </div>

      {/* Error Alert */}
      {error && (
        <div className="bg-red-50 border border-red-200 rounded-lg p-4 flex gap-3">
          <AlertCircle className="w-5 h-5 text-red-600 flex-shrink-0" />
          <p className="text-red-800">{error}</p>
        </div>
      )}

      {/* Read-only Alert for non-drafts */}
      {!isDraft && (
        <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
          <p className="text-blue-800">
            This submission cannot be edited as it has been {submission.status.toLowerCase()}.
          </p>
        </div>
      )}

      {/* Form */}
      <div className="bg-white rounded-lg border border-gray-200 p-6 space-y-4">
        <Input
          label="Title"
          type="text"
          name="title"
          value={editData.title || ''}
          onChange={handleChange}
          disabled={!canEdit}
        />

        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Description
          </label>
          <textarea
            name="description"
            value={editData.description || ''}
            onChange={handleChange}
            disabled={!canEdit}
            rows={4}
            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 disabled:bg-gray-50 disabled:text-gray-600"
          />
        </div>

        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Content
          </label>
          <textarea
            name="content"
            value={editData.content || ''}
            onChange={handleChange}
            disabled={!canEdit}
            rows={6}
            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 disabled:bg-gray-50 disabled:text-gray-600"
          />
        </div>
      </div>

      {/* Actions */}
      {canEdit && (
        <div className="flex gap-3 pt-4 border-t">
          <Button
            variant="primary"
            onClick={handleSave}
            isLoading={isSaving}
          >
            Save Draft
          </Button>
          <Button
            variant="secondary"
            onClick={handleSubmit}
            isLoading={isSubmitting}
          >
            Submit for Review
          </Button>
          <Button
            variant="ghost"
            onClick={() => navigate(`/events/${eventId}/my-submissions`)}
          >
            Cancel
          </Button>
        </div>
      )}

      {!canEdit && (
        <div className="flex gap-3 pt-4 border-t">
          <Button
            variant="ghost"
            onClick={() => navigate(`/events/${eventId}/my-submissions`)}
          >
            Back to Submissions
          </Button>
        </div>
      )}
    </div>
  )
}

export default SubmissionEditor



// ============================================
// FILE: D:\Atria-Frontend\src\types\index.ts
// ============================================
export enum EventType {
  CONFERENCE = 'CONFERENCE',
  FEST = 'FEST',
  PROGRAM = 'PROGRAM',
  CUSTOM = 'CUSTOM'
}

export enum EventStatus {
  DRAFT = 'DRAFT',
  PUBLISHED = 'PUBLISHED',
  ONGOING = 'ONGOING',
  COMPLETED = 'COMPLETED'
}

export interface Event {
  _id: string
  title: string
  description: string
  eventType: EventType
  startDate: string | Date
  endDate: string | Date
  createdBy: string
  isPublic: boolean
  status: EventStatus
  hasTeams?: boolean
  hasCategories?: boolean
  hasJudging?: boolean
  hasScoring?: boolean
  hasSubmissions?: boolean
  createdAt?: string
  updatedAt?: string
}

export enum ParticipationRole {
  PARTICIPANT = 'PARTICIPANT',
  ORGANIZER = 'ORGANIZER',
  JUDGE = 'JUDGE'
}

export enum ParticipationStatus {
  REGISTERED = 'REGISTERED',
  APPROVED = 'APPROVED',
  REJECTED = 'REJECTED',
  WITHDRAWN = 'WITHDRAWN'
}

export interface Participation {
  _id: string
  user: { _id: string; name: string; email: string; role: string }
  event: string
  role: ParticipationRole
  status: ParticipationStatus
  registeredAt: string
  createdAt?: string
  updatedAt?: string
}

export enum ContentType {
  ABSTRACT = 'ABSTRACT',
  PAPER = 'PAPER',
  FILE = 'FILE',
  LINK = 'LINK',
  CUSTOM = 'CUSTOM'
}

export enum SubmissionStatus {
  DRAFT = 'DRAFT',
  SUBMITTED = 'SUBMITTED',
  UNDER_REVIEW = 'UNDER_REVIEW',
  APPROVED = 'APPROVED',
  REJECTED = 'REJECTED'
}

export interface Submission {
  _id: string
  event: string
  participation: string
  title: string
  description: string
  contentType: ContentType
  status: SubmissionStatus
  content?: string
  submittedAt?: string | null
  files?: any[]
  links?: string[]
  meta?: any
  createdAt?: string
  updatedAt?: string
}

export enum UserRole {
  ORGANIZER = 'ORGANIZER',
  PARTICIPANT = 'PARTICIPANT',
  JUDGE = 'JUDGE'
}

export interface User {
  _id: string
  name: string
  email: string
  role: UserRole
}

export interface AuthResponse {
  success: boolean
  message?: string
  data: {
    accessToken: string
    user: User
  }
}

export interface ApiError {
  message: string
  statusCode?: number
}



// ============================================
// FILE: D:\Atria-Frontend\src\utils\formatters.ts
// ============================================
export const formatDate = (dateString: string | Date | undefined): string => {
  if (!dateString) return ''
  const date = new Date(dateString)
  return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })
}

export const formatDateTime = (dateString: string | Date | undefined): string => {
  if (!dateString) return ''
  const date = new Date(dateString)
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  })
}

export const truncateText = (text: string, length: number = 100): string => {
  return text.length > length ? text.substring(0, length) + '...' : text
}

export const getErrorMessage = (error: any): string => {
  if (error?.response?.data?.message) return error.response.data.message
  if (error?.message) return error.message
  return 'An unexpected error occurred'
}



